<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Programirajmo u R-u - old</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Udžbenik za vještinu ‘Osnove programskog jezika R’ na Fakultetu elektrotehnike i računarstva, Sveučilište u Zagrebu.">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Programirajmo u R-u - old" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Udžbenik za vještinu ‘Osnove programskog jezika R’ na Fakultetu elektrotehnike i računarstva, Sveučilište u Zagrebu." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Programirajmo u R-u - old" />
  
  <meta name="twitter:description" content="Udžbenik za vještinu ‘Osnove programskog jezika R’ na Fakultetu elektrotehnike i računarstva, Sveučilište u Zagrebu." />
  

<meta name="author" content="Damir Pintar">


<meta name="date" content="2017-08-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="datumi.html">
<link rel="next" href="vizualizacija-podataka-uz-paket-ggplot2.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />








<style type="text/css">
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 140px;
  height: 4	0px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  font-size:10 pt;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
</style>

<script>
 $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Prikaži rješenje</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Prikaži ispis</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Prikaži sliku</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Prikaži") >= 0) {
      $(this).html(label.replace("Prikaži", "Sakrij"));
    } else {
      $(this).html(label.replace("Sakrij", "Prikaži"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>(Udžbenik za vještinu “Osnove programskog jezika R”)</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#predgovor"><i class="fa fa-check"></i>Predgovor</a></li>
</ul></li>
<li class="part"><span><b>I Osnovni elementi jezika R</b></span></li>
<li class="chapter" data-level="1" data-path="uvod.html"><a href="uvod.html"><i class="fa fa-check"></i><b>1</b> Uvod</a><ul>
<li class="chapter" data-level="1.1" data-path="uvod.html"><a href="uvod.html#sto-je-programski-jezik-r"><i class="fa fa-check"></i><b>1.1</b> Što je programski jezik R?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="uvod.html"><a href="uvod.html#opcenito-o-r-u"><i class="fa fa-check"></i><b>1.1.1</b> Općenito o R-u</a></li>
<li class="chapter" data-level="1.1.2" data-path="uvod.html"><a href="uvod.html#alternative-jeziku-r"><i class="fa fa-check"></i><b>1.1.2</b> Alternative jeziku R</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="uvod.html"><a href="uvod.html#instalacija-programske-podrske"><i class="fa fa-check"></i><b>1.2</b> Instalacija programske podrške</a></li>
<li class="chapter" data-level="1.3" data-path="uvod.html"><a href="uvod.html#pregled-razvojnog-sucelja-rstudio"><i class="fa fa-check"></i><b>1.3</b> Pregled razvojnog sučelja <em>RStudio</em></a><ul>
<li class="chapter" data-level="1.3.1" data-path="uvod.html"><a href="uvod.html#interaktivna-konzola"><i class="fa fa-check"></i><b>1.3.1</b> Interaktivna konzola</a></li>
<li class="chapter" data-level="1.3.2" data-path="uvod.html"><a href="uvod.html#pisanje-r-skripti"><i class="fa fa-check"></i><b>1.3.2</b> Pisanje R skripti</a></li>
<li class="chapter" data-level="1.3.3" data-path="uvod.html"><a href="uvod.html#r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> <em>R Markdown</em></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="uvod.html"><a href="uvod.html#kako-koristiti-ovaj-udzbenik"><i class="fa fa-check"></i><b>1.4</b> Kako koristiti ovaj udžbenik?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipovi.html"><a href="tipovi.html"><i class="fa fa-check"></i><b>2</b> Osnovni tipovi podataka i operatori</a><ul>
<li class="chapter" data-level="2.1" data-path="tipovi.html"><a href="tipovi.html#osnovni-tipovi-podataka"><i class="fa fa-check"></i><b>2.1</b> Osnovni tipovi podataka</a></li>
<li class="chapter" data-level="2.2" data-path="tipovi.html"><a href="tipovi.html#operatori"><i class="fa fa-check"></i><b>2.2</b> Operatori</a></li>
<li class="chapter" data-level="2.3" data-path="tipovi.html"><a href="tipovi.html#nedostajuce-nepoznate-i-nemoguce-vrijednosti"><i class="fa fa-check"></i><b>2.3</b> Nedostajuće, nepoznate i nemoguće vrijednosti</a></li>
<li class="chapter" data-level="" data-path="tipovi.html"><a href="tipovi.html#zadaci-za-vjezbu"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vektori.html"><a href="vektori.html"><i class="fa fa-check"></i><b>3</b> Vektori, matrice i liste</a><ul>
<li class="chapter" data-level="3.1" data-path="vektori.html"><a href="vektori.html#vektori"><i class="fa fa-check"></i><b>3.1</b> Vektori</a><ul>
<li class="chapter" data-level="3.1.1" data-path="vektori.html"><a href="vektori.html#stvaranje-vektora"><i class="fa fa-check"></i><b>3.1.1</b> Stvaranje vektora</a></li>
<li class="chapter" data-level="3.1.2" data-path="vektori.html"><a href="vektori.html#operator"><i class="fa fa-check"></i><b>3.1.2</b> Operator <code>[</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="vektori.html"><a href="vektori.html#principi-vektorizacije-i-recikliranja"><i class="fa fa-check"></i><b>3.1.3</b> Principi vektorizacije i recikliranja</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vektori.html"><a href="vektori.html#indeksni-vektori"><i class="fa fa-check"></i><b>3.2</b> Indeksni vektori</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vektori.html"><a href="vektori.html#lokacijsko-indeksiranje"><i class="fa fa-check"></i><b>3.2.1</b> Lokacijsko indeksiranje</a></li>
<li class="chapter" data-level="3.2.2" data-path="vektori.html"><a href="vektori.html#uvjetno-indeksiranje"><i class="fa fa-check"></i><b>3.2.2</b> Uvjetno indeksiranje</a></li>
<li class="chapter" data-level="3.2.3" data-path="vektori.html"><a href="vektori.html#imensko-indeksiranje"><i class="fa fa-check"></i><b>3.2.3</b> Imensko indeksiranje</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vektori.html"><a href="vektori.html#matrice-i-polja"><i class="fa fa-check"></i><b>3.3</b> Matrice i polja</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vektori.html"><a href="vektori.html#rezanje-matrica"><i class="fa fa-check"></i><b>3.3.1</b> Rezanje matrica</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vektori.html"><a href="vektori.html#liste"><i class="fa fa-check"></i><b>3.4</b> Liste</a></li>
<li class="chapter" data-level="" data-path="vektori.html"><a href="vektori.html#zadaci-za-vjezbu-1"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="okviri.html"><a href="okviri.html"><i class="fa fa-check"></i><b>4</b> Podatkovni okviri i faktori</a><ul>
<li class="chapter" data-level="4.1" data-path="okviri.html"><a href="okviri.html#podatkovni-okviri"><i class="fa fa-check"></i><b>4.1</b> Podatkovni okviri</a></li>
<li class="chapter" data-level="4.2" data-path="okviri.html"><a href="okviri.html#odabir-redaka-i-stupaca-podatkovnih-okvira"><i class="fa fa-check"></i><b>4.2</b> Odabir redaka i stupaca podatkovnih okvira</a></li>
<li class="chapter" data-level="4.3" data-path="okviri.html"><a href="okviri.html#dodavanje-i-brisanje-redaka-i-stupaca"><i class="fa fa-check"></i><b>4.3</b> Dodavanje i brisanje redaka i stupaca</a></li>
<li class="chapter" data-level="4.4" data-path="okviri.html"><a href="okviri.html#faktori"><i class="fa fa-check"></i><b>4.4</b> Faktori</a></li>
<li class="chapter" data-level="" data-path="okviri.html"><a href="okviri.html#zadaci-za-vjezbu-2"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="kontrola.html"><a href="kontrola.html"><i class="fa fa-check"></i><b>5</b> Kontrola toka i objekti</a><ul>
<li class="chapter" data-level="5.1" data-path="kontrola.html"><a href="kontrola.html#naredbe-kontrole-toka"><i class="fa fa-check"></i><b>5.1</b> Naredbe kontrole toka</a><ul>
<li class="chapter" data-level="5.1.1" data-path="kontrola.html"><a href="kontrola.html#uvjetno-izvoenje-naredbi"><i class="fa fa-check"></i><b>5.1.1</b> Uvjetno izvođenje naredbi</a></li>
<li class="chapter" data-level="5.1.2" data-path="kontrola.html"><a href="kontrola.html#programske-petlje"><i class="fa fa-check"></i><b>5.1.2</b> Programske petlje</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="kontrola.html"><a href="kontrola.html#objekti-u-r-u"><i class="fa fa-check"></i><b>5.2</b> Objekti u R-u</a><ul>
<li class="chapter" data-level="5.2.1" data-path="kontrola.html"><a href="kontrola.html#s3-objekti"><i class="fa fa-check"></i><b>5.2.1</b> S3 objekti</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="kontrola.html"><a href="kontrola.html#zadaci-za-vjezbu-3"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="paketi.html"><a href="paketi.html"><i class="fa fa-check"></i><b>6</b> Paketi, ugrađene funkcije i okoline</a><ul>
<li class="chapter" data-level="6.1" data-path="paketi.html"><a href="paketi.html#rad-s-paketima"><i class="fa fa-check"></i><b>6.1</b> Rad s paketima</a></li>
<li class="chapter" data-level="6.2" data-path="paketi.html"><a href="paketi.html#ugraene-funkcije"><i class="fa fa-check"></i><b>6.2</b> Ugrađene funkcije</a></li>
<li class="chapter" data-level="6.3" data-path="paketi.html"><a href="paketi.html#okoline"><i class="fa fa-check"></i><b>6.3</b> Okoline</a></li>
<li class="chapter" data-level="" data-path="paketi.html"><a href="paketi.html#zadaci-za-vjezbu-4"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="korisnik.html"><a href="korisnik.html"><i class="fa fa-check"></i><b>7</b> Korisnički definirane funkcije</a><ul>
<li class="chapter" data-level="7.1" data-path="korisnik.html"><a href="korisnik.html#kako-definirati-funkciju"><i class="fa fa-check"></i><b>7.1</b> Kako definirati funkciju</a><ul>
<li class="chapter" data-level="7.1.1" data-path="korisnik.html"><a href="korisnik.html#princip-kopiranja-kod-izmjene-copy-on-modify"><i class="fa fa-check"></i><b>7.1.1</b> Princip “kopiranja kod izmjene” (copy-on-modify)</a></li>
<li class="chapter" data-level="7.1.2" data-path="korisnik.html"><a href="korisnik.html#funkcija-kao-objekt"><i class="fa fa-check"></i><b>7.1.2</b> Funkcija kao objekt</a></li>
<li class="chapter" data-level="7.1.3" data-path="korisnik.html"><a href="korisnik.html#genericke-funkcije"><i class="fa fa-check"></i><b>7.1.3</b> Generičke funkcije</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="korisnik.html"><a href="korisnik.html#zadaci-za-vjezbu-5"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="porodica-funkcija-apply.html"><a href="porodica-funkcija-apply.html"><i class="fa fa-check"></i><b>8</b> Porodica funkcija <code id="apply">apply</code></a><ul>
<li class="chapter" data-level="8.1" data-path="porodica-funkcija-apply.html"><a href="porodica-funkcija-apply.html#sto-su-apply-funkcije"><i class="fa fa-check"></i><b>8.1</b> Što su <code>apply</code> funkcije?</a></li>
<li class="chapter" data-level="8.2" data-path="porodica-funkcija-apply.html"><a href="porodica-funkcija-apply.html#funkcija-apply"><i class="fa fa-check"></i><b>8.2</b> Funkcija <code>apply</code></a></li>
<li class="chapter" data-level="8.3" data-path="porodica-funkcija-apply.html"><a href="porodica-funkcija-apply.html#funkcije-lapply-sapply-i-vapply"><i class="fa fa-check"></i><b>8.3</b> Funkcije <code>lapply</code>, <code>sapply</code> i <code>vapply</code></a></li>
<li class="chapter" data-level="8.4" data-path="porodica-funkcija-apply.html"><a href="porodica-funkcija-apply.html#ostale-funkcije-iz-porodice-apply-i-dostupne-alternative"><i class="fa fa-check"></i><b>8.4</b> Ostale funkcije iz porodice <code>apply</code> i dostupne alternative</a></li>
<li class="chapter" data-level="" data-path="porodica-funkcija-apply.html"><a href="porodica-funkcija-apply.html#zadaci-za-vjezbu-6"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="part"><span><b>II Upravljanje podacima i vizualizacije</b></span></li>
<li class="chapter" data-level="9" data-path="cijev.html"><a href="cijev.html"><i class="fa fa-check"></i><b>9</b> Operator cjevovoda i uredni podaci</a><ul>
<li class="chapter" data-level="9.1" data-path="cijev.html"><a href="cijev.html#operator-cjevovoda"><i class="fa fa-check"></i><b>9.1</b> Operator cjevovoda</a></li>
<li class="chapter" data-level="9.2" data-path="cijev.html"><a href="cijev.html#uredni-podaci"><i class="fa fa-check"></i><b>9.2</b> Uredni podaci</a><ul>
<li class="chapter" data-level="9.2.1" data-path="cijev.html"><a href="cijev.html#funkcije-gather-i-spread"><i class="fa fa-check"></i><b>9.2.1</b> Funkcije <code>gather</code> i <code>spread</code></a></li>
<li class="chapter" data-level="9.2.2" data-path="cijev.html"><a href="cijev.html#funkcije-separate-i-unite"><i class="fa fa-check"></i><b>9.2.2</b> Funkcije <code>separate</code> i <code>unite</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cijev.html"><a href="cijev.html#zadaci-za-vjezbu-7"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datumi.html"><a href="datumi.html"><i class="fa fa-check"></i><b>10</b> Rad sa datumima i znakovnim nizovima</a><ul>
<li class="chapter" data-level="10.1" data-path="datumi.html"><a href="datumi.html#rad-sa-datumima"><i class="fa fa-check"></i><b>10.1</b> Rad sa datumima</a><ul>
<li class="chapter" data-level="10.1.1" data-path="datumi.html"><a href="datumi.html#klasa-date"><i class="fa fa-check"></i><b>10.1.1</b> Klasa <code>Date</code></a></li>
<li class="chapter" data-level="10.1.2" data-path="datumi.html"><a href="datumi.html#klase-posixct-i-posixlt"><i class="fa fa-check"></i><b>10.1.2</b> Klase <code>POSIXct</code> i <code>POSIXlt</code></a></li>
<li class="chapter" data-level="10.1.3" data-path="datumi.html"><a href="datumi.html#paket-lubridate"><i class="fa fa-check"></i><b>10.1.3</b> Paket <code>lubridate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="datumi.html"><a href="datumi.html#rad-sa-znakovnim-nizovima"><i class="fa fa-check"></i><b>10.2</b> Rad sa znakovnim nizovima</a><ul>
<li class="chapter" data-level="10.2.1" data-path="datumi.html"><a href="datumi.html#analiza-teksta-i-regularni-izrazi"><i class="fa fa-check"></i><b>10.2.1</b> Analiza teksta i regularni izrazi</a></li>
<li class="chapter" data-level="10.2.2" data-path="datumi.html"><a href="datumi.html#paket-stringr"><i class="fa fa-check"></i><b>10.2.2</b> Paket <code>stringr</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datumi.html"><a href="datumi.html#zadaci-za-vjezbu-8"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><i class="fa fa-check"></i><b>11</b> Prilagodba podatkovnih skupova uz paket <code>dplyr</code></a><ul>
<li class="chapter" data-level="11.1" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#ogledni-podatkovni-skup-titanic"><i class="fa fa-check"></i><b>11.1</b> Ogledni podatkovni skup: <em>Titanic</em></a></li>
<li class="chapter" data-level="11.2" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#stvaranje-podskupa-obzervacija-uz-filter-i-slice"><i class="fa fa-check"></i><b>11.2</b> Stvaranje podskupa obzervacija uz <code>filter</code> i <code>slice</code></a></li>
<li class="chapter" data-level="11.3" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#stvaranje-podskupa-varijabli-uz-select"><i class="fa fa-check"></i><b>11.3</b> Stvaranje podskupa varijabli uz <code>select</code></a></li>
<li class="chapter" data-level="11.4" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#stvaranje-novih-stupaca-uz-mutate"><i class="fa fa-check"></i><b>11.4</b> Stvaranje novih stupaca uz <code>mutate</code></a></li>
<li class="chapter" data-level="11.5" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#ogledni-podatkovni-skup-houston-flights"><i class="fa fa-check"></i><b>11.5</b> Ogledni podatkovni skup: <em>Houston flights</em></a></li>
<li class="chapter" data-level="11.6" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#grupiranje-i-agregacija-uz-group_by-i-summarise"><i class="fa fa-check"></i><b>11.6</b> Grupiranje i agregacija uz <code>group_by</code> i <code>summarise</code></a></li>
<li class="chapter" data-level="11.7" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#spajanje-podatkovnih-okvira-uz-join-funkcije"><i class="fa fa-check"></i><b>11.7</b> Spajanje podatkovnih okvira uz join funkcije</a></li>
<li class="chapter" data-level="11.8" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#integracija-sa-relacijskim-bazama-podataka"><i class="fa fa-check"></i><b>11.8</b> Integracija sa relacijskim bazama podataka</a></li>
<li class="chapter" data-level="" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#zadaci-za-vjezbu-9"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html"><i class="fa fa-check"></i><b>12</b> Vizualizacija podataka uz paket <code id="ggplot2">ggplot2</code></a><ul>
<li class="chapter" data-level="12.1" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#eksploratorna-analiza-podataka"><i class="fa fa-check"></i><b>12.1</b> Eksploratorna analiza podataka</a></li>
<li class="chapter" data-level="12.2" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#vizualizacija-podataka-uz-pomoc-jezika-r"><i class="fa fa-check"></i><b>12.2</b> Vizualizacija podataka uz pomoć jezika R</a></li>
<li class="chapter" data-level="12.3" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#graficka-gramatika-i-paket-ggplot2"><i class="fa fa-check"></i><b>12.3</b> Grafička gramatika i paket <code>ggplot2</code></a><ul>
<li class="chapter" data-level="12.3.1" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#aspekti-podataka-estetike-i-geometrije"><i class="fa fa-check"></i><b>12.3.1</b> Aspekti podataka, estetike i geometrije</a></li>
<li class="chapter" data-level="12.3.2" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#fiksni-parametri-geometrije"><i class="fa fa-check"></i><b>12.3.2</b> Fiksni parametri geometrije</a></li>
<li class="chapter" data-level="12.3.3" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#aspekti-statistike-i-pozicije"><i class="fa fa-check"></i><b>12.3.3</b> Aspekti statistike i pozicije</a></li>
<li class="chapter" data-level="12.3.4" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#povezanost-geometrije-i-statistike"><i class="fa fa-check"></i><b>12.3.4</b> Povezanost geometrije i statistike</a></li>
<li class="chapter" data-level="12.3.5" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#aspekti-skale-koordinatnog-sustava-i-teme"><i class="fa fa-check"></i><b>12.3.5</b> Aspekti skale, koordinatnog sustava i teme</a></li>
<li class="chapter" data-level="12.3.6" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#uvjetni-facetirani-grafovi"><i class="fa fa-check"></i><b>12.3.6</b> Uvjetni (facetirani) grafovi</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#grafovi-u-eksploratornoj-analizi-i-izvjestavanju"><i class="fa fa-check"></i><b>12.4</b> Grafovi u eksploratornoj analizi i izvještavanju</a></li>
<li class="chapter" data-level="" data-path="vizualizacija-podataka-uz-paket-ggplot2.html"><a href="vizualizacija-podataka-uz-paket-ggplot2.html#zadaci-za-vjezbu-10"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="part"><span><b>III Statistika i strojno učenje u jeziku R</b></span></li>
<li class="chapter" data-level="13" data-path="razdiobe.html"><a href="razdiobe.html"><i class="fa fa-check"></i><b>13</b> Statističko programiranje, razdiobe i simulacije</a><ul>
<li class="chapter" data-level="13.1" data-path="razdiobe.html"><a href="razdiobe.html#rad-sa-razdiobama-vjerojatnosti-u-jeziku-r"><i class="fa fa-check"></i><b>13.1</b> Rad sa razdiobama vjerojatnosti u jeziku R</a></li>
<li class="chapter" data-level="13.2" data-path="razdiobe.html"><a href="razdiobe.html#simulacije"><i class="fa fa-check"></i><b>13.2</b> Simulacije</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="deskriptivna.html"><a href="deskriptivna.html"><i class="fa fa-check"></i><b>14</b> Deskriptivna i inferencijalna statistika u jeziku R</a><ul>
<li class="chapter" data-level="14.1" data-path="deskriptivna.html"><a href="deskriptivna.html#deskriptivna-statistika"><i class="fa fa-check"></i><b>14.1</b> Deskriptivna statistika</a><ul>
<li class="chapter" data-level="14.1.1" data-path="deskriptivna.html"><a href="deskriptivna.html#univarijantna-deskriptivna-statistika"><i class="fa fa-check"></i><b>14.1.1</b> Univarijantna deskriptivna statistika</a></li>
<li class="chapter" data-level="14.1.2" data-path="deskriptivna.html"><a href="deskriptivna.html#bivarijantna-i-multivarijantna-deskriptivna-statistika"><i class="fa fa-check"></i><b>14.1.2</b> Bivarijantna i multivarijantna deskriptivna statistika</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="deskriptivna.html"><a href="deskriptivna.html#inferencijalna-statistika"><i class="fa fa-check"></i><b>14.2</b> Inferencijalna statistika</a><ul>
<li class="chapter" data-level="14.2.1" data-path="deskriptivna.html"><a href="deskriptivna.html#testiranje-hipoteza"><i class="fa fa-check"></i><b>14.2.1</b> Testiranje hipoteza</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="regresija.html"><a href="regresija.html"><i class="fa fa-check"></i><b>15</b> Odabrane metode strojnog učenja: regresijska analiza</a><ul>
<li class="chapter" data-level="15.1" data-path="regresija.html"><a href="regresija.html#strojno-ucenje-i-prediktivna-analiza"><i class="fa fa-check"></i><b>15.1</b> Strojno učenje i prediktivna analiza</a><ul>
<li class="chapter" data-level="15.1.1" data-path="regresija.html"><a href="regresija.html#stvaranje-prediktivnog-modela"><i class="fa fa-check"></i><b>15.1.1</b> Stvaranje prediktivnog modela</a></li>
<li class="chapter" data-level="15.1.2" data-path="regresija.html"><a href="regresija.html#jednostavna-linearna-regresija"><i class="fa fa-check"></i><b>15.1.2</b> Jednostavna linearna regresija</a></li>
<li class="chapter" data-level="15.1.3" data-path="regresija.html"><a href="regresija.html#funkcija-lm"><i class="fa fa-check"></i><b>15.1.3</b> Funkcija <code>lm</code></a></li>
<li class="chapter" data-level="15.1.4" data-path="regresija.html"><a href="regresija.html#linearna-regresija-i-kategorijske-varijable"><i class="fa fa-check"></i><b>15.1.4</b> Linearna regresija i kategorijske varijable</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="regresija.html"><a href="regresija.html#visestruka-multipla-linearna-regresija"><i class="fa fa-check"></i><b>15.2</b> Višestruka (multipla) linearna regresija</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Programirajmo u R-u - old</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="prilagodba-podatkovnih-skupova-uz-paket-dplyr" class="section level1">
<h1><span class="header-section-number">11</span> Prilagodba podatkovnih skupova uz paket <code>dplyr</code></h1>
<p>Paket <code>dplyr</code> jedan je od novijih paketa jezika <em>R</em> čija je glavna funkcija učinkovito i pojednostavljeno upravljanje podatkovnim okvirima uz pomoć skupa intuitivno dizajniranih funkcija. U trenutku pisanja ove lekcije <a href = "https://www.rdocumentation.org/"> nalazi se na vrhu liste najpopularnijih paketa </a> usprkos jakoj “konkurenciji” u ovom području koju čine iznimno popularni paketi kao što su <code>plyr</code>, <code>data.table</code> ali i osnovne, tradicionalne metode za rad sa podatkovnim okvirima. Bilo koja od ovih opcija predstavlja dobar izbor, a iako paket <code>dplyr</code> nije najučinkovitiji glede samih performansi (daleko najbolje performanse trenutno nudi paket <code>data.table</code>), prednost ovog paketa je njegova intuitivna, čitljiva sintaksa koja programski rad sa podatkovnim okvirima čini brzim i jednostavnim te je odličan izbor za programere koji se upoznaju sa <em>R</em>-om ili se jednostavno žele usredotočiti na rad sa podacima kroz čitljiv, lako održiv programski kod.</p>
<p>Konkretne prednosti koje donosi paket dplyr su sljedeće:</p>
<ul>
<li>jednostavna sintaksa (slična SQL-u, ali proceduralna) koja koristi pet glavnih “glagola” za manipulaciju podatkovnim okvirima i kao takva definira svojevrsni samostalni jezik unutar jezika <em>R</em></li>
<li>veća učinkovitost od metoda koje nudi osnovni paket (inicijalno je <code>dplyr</code> dizajniran za veću učinkovitost programiranja, ne nužno za bolje performanse, no u međuvremenu implementacija određenih rutina u C-u omogućila je i poboljšanje i performansi izvođenja)</li>
<li>integracija sa relacijskim bazama podataka (funkcije paketa <code>dplyr</code> mogu se koristiti direktno nad tablicama u bazi uz pomoć automatskog prevođenja funkcija paketa <code>dplyr</code> u SQL naredbe)</li>
</ul>
<p>Spomenutih osnovnih “pet glagola” koje nudi paket <code>dplyr</code> su sljedeći:</p>
<ul>
<li><code>filter</code> - za filtriranje podatkovnog skupa po retcima</li>
<li><code>select</code> - za odabir pojedinih stupaca</li>
<li><code>arrange</code> - za promjenu redoslijeda redaka</li>
<li><code>mutate</code> - za stvaranje novih stupaca iz postojećih</li>
<li><code>summarise</code> - za agregiranje podataka</li>
</ul>
<p>Pored pet osnovnih glagola vrlo često koristimo i:</p>
<ul>
<li><code>group_by</code> za grupiranje podataka unutar podatkovnog skupa</li>
<li>porodicu <code>join</code> funkcija za spajanje podatkovnih okvira</li>
</ul>
<p>Poznavatelji jezika SQL lako će uočiti paralele između tog jezika i navedenih funkcionalnosti paketa <code>dplyr</code>. Najveća razlika jest u tome što SQL radi “deklarativno”, tj. moramo pratiti pravila izgradnje SQL naredbe koja “sve radi odjednom”, dok u <em>R</em>-u uz pomoć funkcija paketa <code>dplyr</code> i već ranije upoznatog operatora <code>%&gt;%</code> radnje nad podatkovnim skupovima možemo izvoditi proceduralno, s jasnim tijekom obrade podataka slijeva na desno.</p>
<p>Prije detaljnog pregleda funkcionalnosti paketa <code>dplyr</code> pogledajmo ogledni podatkovni skup kojeg ćemo koristiti tijekom ove lekcije.</p>
<div id="ogledni-podatkovni-skup-titanic" class="section level2">
<h2><span class="header-section-number">11.1</span> Ogledni podatkovni skup: <em>Titanic</em></h2>
<p>Odaberimo za početak jedan često korišteni podatkovni skup – <em>“Titanic Passenger Survival Dataset”</em>. Ovaj skup pruža informacije o sudbinama putnika prekoocenaskog putničkog broda Titanic koji je potonuo 14. travnja 1912. godine pri čemu je od 2223 putnika i članova posade preživjelo samo njih 706. Podatkovni skup između ostalog sadrži imena putnika, spol, godište u trenutku potonuća, putničku klasu i sl. Postoji inačica ovog podatkovnog skupa koja dolazi sa samom <em>R</em> distribucijom, no mi ćemo koristiti njegovu proširenu inačicu sa <em>Kaggle</em> natjecanja <em>“Titanic: Machine Learning From Disaster”</em> o kojem se više detalja može saznati na <a href = "https://www.kaggle.com/c/titanic">ovoj poveznici</a>.</p>
<p>Učitajmo navedeni podatkovni skup.</p>
<hr />
<p><strong>Zadatak 11.1 - podatkovni skup ‘Titanic’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#učitajte podatkovni skup iz datoteke `Titanic.csv` u varijablu `titanic`</span>

<span class="co">#pogledajte strukturu podatkovnog okvira `titanic` uz pomoć funkcije `str`</span>
<span class="co">#i prvih nekoliko redaka uz pomoć funkcije `head`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Titanic.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)

<span class="kw">str</span>(titanic)
<span class="kw">head</span>(titanic)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    891 obs. of  12 variables:
##  $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Survived   : int  0 1 1 1 0 0 0 0 1 1 ...
##  $ Pclass     : int  3 1 3 1 3 3 1 3 3 2 ...
##  $ Name       : chr  &quot;Braund, Mr. Owen Harris&quot; &quot;Cumings, Mrs. John Bradley (Florence Briggs Thayer)&quot; &quot;Heikkinen, Miss. Laina&quot; &quot;Futrelle, Mrs. Jacques Heath (Lily May Peel)&quot; ...
##  $ Sex        : chr  &quot;male&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...
##  $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...
##  $ Ticket     : chr  &quot;A/5 21171&quot; &quot;PC 17599&quot; &quot;STON/O2. 3101282&quot; &quot;113803&quot; ...
##  $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
##  $ Cabin      : chr  &quot;&quot; &quot;C85&quot; &quot;&quot; &quot;C123&quot; ...
##  $ Embarked   : chr  &quot;S&quot; &quot;C&quot; &quot;S&quot; &quot;S&quot; ...
##   PassengerId Survived Pclass
## 1           1        0      3
## 2           2        1      1
## 3           3        1      3
## 4           4        1      1
## 5           5        0      3
## 6           6        0      3
##                                                  Name    Sex Age SibSp
## 1                             Braund, Mr. Owen Harris   male  22     1
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer) female  38     1
## 3                              Heikkinen, Miss. Laina female  26     0
## 4        Futrelle, Mrs. Jacques Heath (Lily May Peel) female  35     1
## 5                            Allen, Mr. William Henry   male  35     0
## 6                                    Moran, Mr. James   male  NA     0
##   Parch           Ticket    Fare Cabin Embarked
## 1     0        A/5 21171  7.2500              S
## 2     0         PC 17599 71.2833   C85        C
## 3     0 STON/O2. 3101282  7.9250              S
## 4     0           113803 53.1000  C123        S
## 5     0           373450  8.0500              S
## 6     0           330877  8.4583              Q</code></pre>
</div>
<hr />
<p>Prije nastavka pokažimo dvije funkcije dostupne preko paketa <code>dplyr</code> koje se mogu pokazati jako korisne kod rada sa podatkovnim okvirima: <code>tbl_df</code> i <code>glimpse</code>.</p>
<p>Funkcijom <code>tbl_df</code> pretvaramo obični podatkovni okvir u objekt klase <code>tbl</code>, koja je zapravo “omotač” oko podatkovnog okvira, a s ciljem da se rad s podacima učini u izvjesnoj mjeri praktičnijim. Najveća prednost ovog tipa objekta jest što će se kod pokušaja ispisa cijelog okvira na zaslon (što se najčešće događa omaškom i što rezultira “smrzavanjem” <em>R</em> konzole) pozvati posebna funkcija koja će ispisati samo dio okvira i moći će se odmah nastaviti s radom. Postoje i neke dodatne prednosti - npr. bilo kakav tip ispisa samih podataka na zaslon automatski se prilagođava širini zaslona - no prethodno navedena funkcionalnost je sama po sebi dovoljan razlog korištenja ove funkcije, što znaju svi korisnici <em>R</em>-a kojima se dogodio naprasni prekid procesa analize samo zbog nesmotrenog unosa imena varijable okvira i pritiska tipke <em>“enter”</em>.</p>
<p>Druga funkcija koju ćemo prikazati je <code>glimpse</code> - inačica funkcije str nešto intuitivnijeg imena koja također ima prednost maksimalnog iskorištavanja dostupnog prostora za ispis.</p>
<hr />
<p><strong>Zadatak 11.2 - funkcije ‘tbl_df’ i ‘glimpse’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#pozovite funkciju `tbl_df` nad tablicom `titanic`</span>
<span class="co">#rezultat smjestite u istu varijablu</span>

<span class="co">#pozovite funkciju `glimpse` nad tablicom `titanic`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(titanic)

<span class="kw">glimpse</span>(titanic)</code></pre></div>
<pre><code>## Observations: 891
## Variables: 12
## $ PassengerId &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,...
## $ Survived    &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0,...
## $ Pclass      &lt;int&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3,...
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bra...
## $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;mal...
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, ...
## $ SibSp       &lt;int&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4,...
## $ Parch       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1,...
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;1138...
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, ...
## $ Cabin       &lt;chr&gt; &quot;&quot;, &quot;C85&quot;, &quot;&quot;, &quot;C123&quot;, &quot;&quot;, &quot;&quot;, &quot;E46&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, ...</code></pre>
</div>
<hr />
<p>Navedene funkcije nisu nužne za korištenje ostalih funkcija paketa <code>dplyr</code>, no u svakom slučaju se preporučuju.</p>
<p>Prije nastavka bilo bi dobro pobliže se upoznati sa podatkovnim skupom kojeg ćemo koristiti, bilo nešto detaljnijim istraživanjem podatkovnog skupa, bilo prikupljanjem dokumentacije o istom. Kraći opis samog podatkovnog skupa preuzet sa službenih stranica Keggle natjecanja slijedi:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">VARIABLE DESCRIPTIONS:
survival        Survival
                (<span class="dv">0</span> =<span class="st"> </span>No; <span class="dv">1</span> =<span class="st"> </span>Yes)
pclass          Passenger Class
                (<span class="dv">1</span> =<span class="st"> </span>1st; <span class="dv">2</span> =<span class="st"> </span>2nd; <span class="dv">3</span> =<span class="st"> </span>3rd)
name            Name
sex             Sex
age             Age
sibsp           Number of Siblings/Spouses Aboard
parch           Number of Parents/Children Aboard
ticket          Ticket Number
fare            Passenger Fare
cabin           Cabin
embarked        Port of Embarkation
                (<span class="dt">C =</span> Cherbourg; <span class="dt">Q =</span> Queenstown; <span class="dt">S =</span> Southampton)

SPECIAL NOTES:
Pclass is a proxy for socio-economic <span class="kw">status</span> (SES)
 1st ~<span class="st"> </span>Upper; 2nd ~<span class="st"> </span>Middle; 3rd ~<span class="st"> </span>Lower

Age is in Years; Fractional if Age less than <span class="kw">One</span> (<span class="dv">1</span>)
 If the Age is Estimated, it is in the form xx<span class="fl">.5</span>

With respect to the family relation <span class="kw">variables</span> (i.e. sibsp and parch)
some relations were ignored.  The following are the definitions used
for sibsp and parch.

Sibling:<span class="st">  </span>Brother, Sister, Stepbrother, or Stepsister of Passenger Aboard Titanic
Spouse:<span class="st">   </span>Husband or Wife of Passenger Aboard <span class="kw">Titanic</span> (Mistresses and Fiances Ignored)
Parent:<span class="st">   </span>Mother or Father of Passenger Aboard Titanic
Child:<span class="st">    </span>Son, Daughter, Stepson, or Stepdaughter of Passenger Aboard Titanic

Other family relatives excluded from this study include cousins,
nephews/nieces, aunts/uncles, and in-laws.  Some children travelled
only with a nanny, therefore parch=<span class="dv">0</span> for them.  As well, some
travelled with very close friends or neighbors in a village, however,
the definitions do not support such relations.</code></pre></div>
<p>Sada kada dobro razumijemo naš podatkovni skup, možemo krenuti sa upoznavanjem funkcija paketa <code>dplyr</code>.</p>
</div>
<div id="stvaranje-podskupa-obzervacija-uz-filter-i-slice" class="section level2">
<h2><span class="header-section-number">11.2</span> Stvaranje podskupa obzervacija uz <code>filter</code> i <code>slice</code></h2>
<p>U poglavlju o podatkovnim okvirima smo već naučili da se “rezanje” podatkovnih okvira može raditi slično rezanju matrica - uz pomoć indeksnih vektora kojima definiramo koje retke/stupce zadržavamo. Isto tako, naučili smo da indeksni vektori mogu biti cjelobrojni (lokacijski), logički i imenski.</p>
<p>Kod definicije podskupa redaka daleko najčešći tip indeksnog vektora je logički - uz pomoć varijabli tj. stupaca definiramo određeni kriterij koji “filtrira” retke. Nažalost, osnovna <em>R</em>-ova sintaksa korištenja logičkih indeksnih redaka za određivanje podskupa redaka je ponešto nespretna, što se može vidjeti iz primjera:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">podaci[podaci$a &gt;<span class="st"> </span><span class="dv">5</span> &amp;<span class="st"> </span>podaci$b !=<span class="st"> </span><span class="dv">3</span>, ]</code></pre></div>
<p>Prvi i očiti problem jest potreba ponavljanja imena podatkovnog okvira (koju možemo eliminirati uz pomoć funkcije <code>attach</code>, što smo rekli da nije idealno rješenje jer donosi niz novih potencijalnih problema). Drugo pitanje jest problem čitljivosti - gornju naredbu nije lako vizualno interpretirati, tj. naknadnim pregledom koda nije lako odmah uočiti da se radi o reduciranju broja redaka.</p>
<p>Funkcija <code>filter</code> eksplicitnom sintaksom odaje da se radi o filtriranju redaka, a također omogućuje korištenje imena stupaca bez potrebe za referenciranjem imena podatkovnog okvira:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(podaci, a &gt;<span class="st"> </span><span class="dv">5</span> &amp;<span class="st"> </span>b !=<span class="st"> </span><span class="dv">3</span>)</code></pre></div>
<p>Isto tako, dobro je uočiti da je prvi argument funkcije sam podatkovni skup, što nam omogućuje jednostavno ulančavanje. Na ovom principu dizajnirana je većina funkcija paketa <code>dplyr</code>.</p>
<p>Gore navedena funkcija predstavlja najčešći način odabira podskupa redaka (poznavatelji SQL-a uočiti će sličnost sa WHERE segmentom SQL upita). Pored funkcije filter, za određivanje podskupa redaka imamo i sljedeće funkcije, također vrlo intuitivnih imena (radi lakše interpretacije umjesto potpisa funkcija dajemo primjere parametara):</p>
<ul>
<li><code>distinct(podaci)</code> - za uklanjanje duplikata</li>
<li><code>slice(podaci, 1:10)</code> - za lokacijsko indeksiranje</li>
<li><code>sample_frac(podaci, 0.2)</code> - nasumični odabir dijela skupa po danom omjeru</li>
<li><code>sample_n(podaci, 50)</code> - nasumični odabir zadanog broja redaka</li>
<li><code>top_n(podaci, 10, a)</code> - prvih n redaka, gledano po poretku stupca a</li>
</ul>
<p>Za poredak redaka u ispisu možemo koristiti:</p>
<ul>
<li><code>arrange(podaci, a, desc(b))</code> - poredaj po stupcu <code>a</code> uzlazno pa po <code>b</code> silazno</li>
</ul>
<p>Isprobajmo ovo na primjerima:</p>
<hr />
<p><strong>Zadatak 11.3 - funkcija ‘filter’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite podatke o svim putnicima prve klase starijim od 60 godina</span>

<span class="co"># ispišite podatke o svim preživjelim muškim putnicima koji </span>
<span class="co"># u imenu imaju `George` ili `Frank`</span>

<span class="co"># provjerite ima li u podatkovnom skupu duplih obzervacija</span>

<span class="co"># nasumično izaberite i ispišite podatke o pet putnika koji nisu preživjeli potonuće</span>
<span class="co"># ispis poredati silazno po cijeni karte</span>

<span class="co"># ispišite podatke o pet najstarijih putnica prve klase </span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite podatke o svim putnicima prve klase starijim od 60 godina</span>
<span class="kw">filter</span>(titanic, Pclass ==<span class="st"> </span><span class="dv">3</span> &amp;<span class="st"> </span>Age &gt;<span class="st"> </span><span class="dv">60</span>)</code></pre></div>
<pre><code>## # A tibble: 5 × 12
##   PassengerId Survived Pclass                      Name    Sex   Age SibSp
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt;                     &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
## 1         117        0      3      Connors, Mr. Patrick   male  70.5     0
## 2         281        0      3          Duane, Mr. Frank   male  65.0     0
## 3         327        0      3 Nysveen, Mr. Johan Hansen   male  61.0     0
## 4         484        1      3    Turkula, Mrs. (Hedwig) female  63.0     0
## 5         852        0      3       Svensson, Mr. Johan   male  74.0     0
## # ... with 5 more variables: Parch &lt;int&gt;, Ticket &lt;chr&gt;, Fare &lt;dbl&gt;,
## #   Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite podatke o svim preživjelim muškim putnicima koji </span>
<span class="co"># u imenu imaju `George` ili `Frank`</span>
<span class="kw">filter</span>(titanic, <span class="kw">str_detect</span>(Name, <span class="st">&quot;(George|Frank)&quot;</span>) &amp;<span class="st"> </span>Sex ==<span class="st"> &quot;male&quot;</span> &amp;<span class="st"> </span>Survived)</code></pre></div>
<pre><code>## # A tibble: 6 × 12
##   PassengerId Survived Pclass
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt;
## 1         166        1      3
## 2         371        1      1
## 3         508        1      1
## 4         571        1      2
## 5         710        1      3
## 6         832        1      2
## # ... with 9 more variables: Name &lt;chr&gt;, Sex &lt;chr&gt;, Age &lt;dbl&gt;,
## #   SibSp &lt;int&gt;, Parch &lt;int&gt;, Ticket &lt;chr&gt;, Fare &lt;dbl&gt;, Cabin &lt;chr&gt;,
## #   Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># provjerite ima li u podatkovnom skupu duplih obzervacija</span>
<span class="kw">nrow</span>(titanic) ==<span class="st"> </span><span class="kw">nrow</span>(<span class="kw">distinct</span>(titanic))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nasumično izaberite i ispišite podatke o pet putnika koji nisu preživjeli potonuće</span>
<span class="co"># ispis poredati silazno po cijeni karte</span>
<span class="kw">filter</span>(titanic, !Survived) %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">5</span>) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Fare))</code></pre></div>
<pre><code>## # A tibble: 5 × 12
##   PassengerId Survived Pclass                                        Name
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt;                                       &lt;chr&gt;
## 1         267        0      3                   Panula, Mr. Ernesti Arvid
## 2         568        0      3 Palsson, Mrs. Nils (Alma Cornelia Berglund)
## 3         452        0      3             Hagland, Mr. Ingvald Olai Olsen
## 4         853        0      3                     Boulos, Miss. Nourelain
## 5         114        0      3                     Jussila, Miss. Katriina
## # ... with 8 more variables: Sex &lt;chr&gt;, Age &lt;dbl&gt;, SibSp &lt;int&gt;,
## #   Parch &lt;int&gt;, Ticket &lt;chr&gt;, Fare &lt;dbl&gt;, Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite podatke o pet najstarijih putnica prve klase </span>
<span class="kw">filter</span>(titanic, Pclass ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>Sex ==<span class="st"> &quot;female&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">top_n</span>(<span class="dv">5</span>, Age) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(Age)</code></pre></div>
<pre><code>## # A tibble: 6 × 12
##   PassengerId Survived Pclass
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt;
## 1          12        1      1
## 2         196        1      1
## 3         269        1      1
## 4         367        1      1
## 5         830        1      1
## 6         276        1      1
## # ... with 9 more variables: Name &lt;chr&gt;, Sex &lt;chr&gt;, Age &lt;dbl&gt;,
## #   SibSp &lt;int&gt;, Parch &lt;int&gt;, Ticket &lt;chr&gt;, Fare &lt;dbl&gt;, Cabin &lt;chr&gt;,
## #   Embarked &lt;chr&gt;</code></pre>
</div>
<hr />
<p>Uočite da “prvih n” redaka samo odabire podskup redaka, neće ga nužno ispisati po redu. Ukoliko želimo poredani ispis moramo koristiti i funkciju <code>arrange</code>.</p>
</div>
<div id="stvaranje-podskupa-varijabli-uz-select" class="section level2">
<h2><span class="header-section-number">11.3</span> Stvaranje podskupa varijabli uz <code>select</code></h2>
<p>Druga metoda rezanja podatkovnog okvira jest odabir podskupa stupaca. Za razliku od biranja podskupa redaka, gdje se najčešće služimo logičkim indeksiranjem tj. filtriranjem po određenom kriteriju, stupce tj. varijable najčešće referenciramo po njihovom imenu. Sintaksa odabira podskupa stupaca po imenu uz pomoć osnovnog načina indeksiranja u <em>R</em>-u izgleda na primjer ovako:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">podaci[, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)]</code></pre></div>
<p>Ovdje također uočavamo određenu nespretnost i teškoću interpretacije. Nazivi stupaca moraju biti ugrađeni u funkciju stvaranja vektora što smanjuje čitljivost, a naredba nigdje eksplicitno ne iskazuje da se radi o odabiru stupaca već do moramo zaključiti iz položaja indeksnog vektora. Dodatno, nema jednostavnog načina za odabir raspona stupaca po imenu, postojanju nekog podniza ili uzorka unutar imena i sl.</p>
<p>Funkcija <code>select</code> nam omogućuje eksplicitni odabir stupaca uz pomoć sintakse:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(podaci, a, b, c)</code></pre></div>
<p>Dakle jednostavno navodimo podatkovni okvir i niz stupaca koje želimo odabrati. Ovdje je također lako uočiti sličnost sa SQL-om, konkretno SELECT segmentom SQL upita.</p>
<p>No gornja sintaksa nije sve što ova funkcija nudi - <code>select</code> ima čitav niz pomoćnih funkcija i operatora koji uvelike proširuju njezinu funkcionalnost, kao npr:</p>
<ul>
<li><code>select(podaci, a:c)</code> - odaberi stupce od <code>a</code> do <code>c</code></li>
<li><code>select(podaci, -a, -b)</code> - odaberi sve stupce osim <code>a</code> i <code>b</code></li>
<li><code>select(podaci, starts_with(&quot;PO&quot;)))</code> - odaberi stupce koji počinju sa slovima <code>&quot;PO&quot;</code></li>
<li><code>select(podaci, contains(&quot;stup&quot;))</code> - odaberi stupce koji sadrže podniz <code>&quot;stup&quot;</code></li>
<li><code>select(podaci, matches(&quot;[123]{2,3}&quot;))</code> - odaberi stupce koji odgovaraju danom regularnom izrazu</li>
</ul>
<p>Ovo nisu sve mogućnosti, no dodatne opcije lako je pronaći u službenoj dokumentaciji.</p>
<p>Isprobajmo ovu naredbu, također na podatkovnom skupu Titanic.</p>
<hr />
<p><strong>Zadatak 11.4 - funkcija ‘select’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za nasumično odabranih 10 redaka ispišite ime putnika, dob te </span>
<span class="co"># da li je preživio potonuće ili ne</span>

<span class="co"># za prvih 10 najstarijih putnika ispišite sve atribute od imena do cijene karte</span>

<span class="co"># za nasumično odabranih 1% redaka ispišite sve atribute osim identifikatora </span>
<span class="co"># putnika i broja kabine</span>

<span class="co"># za retke od broja 10 do broja 20 ispišite sve stupce koji počinju samoglasnikom</span>

<span class="co"># za nasumičnih 10 putnika koji imaju nepoznat broj godina ispišite sve </span>
<span class="co"># atribute od imena do cijene karte, </span>
<span class="co"># potom putničku klasu te konačno da li je putnik preživio ili ne</span>
<span class="co"># poredajte ispis abecedno po imenu</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za nasumično odabranih 10 redaka ispišite ime putnika, dob te</span>
<span class="co"># da li je preživio potonuće ili ne</span>
<span class="kw">sample_n</span>(titanic, <span class="dv">10</span>) %&gt;%<span class="st"> </span><span class="kw">select</span>(Name, Age, Survived)</code></pre></div>
<pre><code>## # A tibble: 10 × 3
##                                            Name   Age Survived
##                                           &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;
## 1               Landergren, Miss. Aurora Adelia    22        1
## 2            Andersson, Miss. Ebba Iris Alfrida     6        0
## 3       Meek, Mrs. Thomas (Annie Louise Rowley)    NA        0
## 4                        Andrews, Mr. Thomas Jr    39        0
## 5                      Quick, Miss. Phyllis May     2        1
## 6  de Messemaeker, Mrs. Guillaume Joseph (Emma)    36        1
## 7              Gronnestad, Mr. Daniel Danielsen    32        0
## 8             Johannesen-Bratthammer, Mr. Bernt    NA        1
## 9                   van Melkebeke, Mr. Philemon    NA        0
## 10                      de Mulder, Mr. Theodore    30        1</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za prvih 10 najstarijih putnika ispišite sve atribute od imena do cijene karte</span>
<span class="kw">top_n</span>(titanic, <span class="dv">10</span>, Age) %&gt;%<span class="st"> </span><span class="kw">select</span>(Name:Fare)</code></pre></div>
<pre><code>## # A tibble: 11 × 7
##                                    Name   Sex   Age SibSp Parch     Ticket
##                                   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;      &lt;chr&gt;
## 1                 Wheadon, Mr. Edward H  male  66.0     0     0 C.A. 24579
## 2        Ostby, Mr. Engelhart Cornelius  male  65.0     0     1     113509
## 3             Goldschmidt, Mr. George B  male  71.0     0     0   PC 17754
## 4                  Connors, Mr. Patrick  male  70.5     0     0     370369
## 5                      Duane, Mr. Frank  male  65.0     0     0     336439
## 6             Millet, Mr. Francis Davis  male  65.0     0     0      13509
## 7               Artagaveytia, Mr. Ramon  male  71.0     0     0   PC 17609
## 8  Barkworth, Mr. Algernon Henry Wilson  male  80.0     0     0      27042
## 9           Mitchell, Mr. Henry Michael  male  70.0     0     0 C.A. 24580
## 10         Crosby, Capt. Edward Gifford  male  70.0     1     1  WE/P 5735
## 11                  Svensson, Mr. Johan  male  74.0     0     0     347060
## # ... with 1 more variables: Fare &lt;dbl&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za nasumično odabranih 1% redaka ispišite sve atribute osim identifikatora </span>
<span class="co"># putnika i broja kabine</span>
<span class="kw">sample_frac</span>(titanic, <span class="fl">0.01</span>) %&gt;%<span class="st"> </span><span class="kw">select</span>(-PassengerId, -Cabin)</code></pre></div>
<pre><code>## # A tibble: 9 × 10
##   Survived Pclass                           Name    Sex   Age SibSp Parch
##      &lt;int&gt;  &lt;int&gt;                          &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1        0      3               Flynn, Mr. James   male    NA     0     0
## 2        0      2           Moraweck, Dr. Ernest   male    54     0     0
## 3        0      1            Robbins, Mr. Victor   male    NA     0     0
## 4        0      2   Eitemiller, Mr. George Floyd   male    23     0     0
## 5        0      3 O&#39;Sullivan, Miss. Bridget Mary female    NA     0     0
## 6        0      3    van Melkebeke, Mr. Philemon   male    NA     0     0
## 7        1      3       Daly, Mr. Eugene Patrick   male    29     0     0
## 8        0      3           Sadlier, Mr. Matthew   male    NA     0     0
## 9        0      3            Sage, Mr. Frederick   male    NA     8     2
## # ... with 3 more variables: Ticket &lt;chr&gt;, Fare &lt;dbl&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za retke od broja 10 do broja 20 ispišite sve stupce koji počinju samoglasnikom</span>
<span class="kw">slice</span>(titanic, <span class="dv">10</span>:<span class="dv">20</span>) %&gt;%<span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^[AEIOU]&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 11 × 2
##      Age Embarked
##    &lt;dbl&gt;    &lt;chr&gt;
## 1     14        C
## 2      4        S
## 3     58        S
## 4     20        S
## 5     39        S
## 6     14        S
## 7     55        S
## 8      2        Q
## 9     NA        S
## 10    31        S
## 11    NA        C</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za nasumičnih 10 putnika koji imaju nepoznat broj godina ispišite sve </span>
<span class="co"># atribute od imena do cijene karte, </span>
<span class="co"># potom putničku klasu te konačno da li je putnik preživio ili ne</span>
<span class="co"># poredajte ispis abecedno po imenu</span>
<span class="kw">filter</span>(titanic, <span class="kw">is.na</span>(Age)) %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Name:Fare, Pclass, Survived) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(Name)</code></pre></div>
<pre><code>## # A tibble: 10 × 9
##                                            Name    Sex   Age SibSp Parch
##                                           &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1                   Clifford, Mr. George Quincy   male    NA     0     0
## 2  Goldenberg, Mrs. Samuel L (Edwiga Grabowska) female    NA     1     0
## 3                          Knight, Mr. Robert J   male    NA     0     0
## 4                            McCoy, Miss. Agnes female    NA     2     0
## 5                           O&#39;Brien, Mr. Thomas   male    NA     1     0
## 6             Sage, Miss. Dorothy Edith &quot;Dolly&quot; female    NA     8     2
## 7                           Sage, Mr. Frederick   male    NA     8     2
## 8                            Scanlan, Mr. James   male    NA     0     0
## 9                             Webber, Mr. James   male    NA     0     0
## 10                            Woolner, Mr. Hugh   male    NA     0     0
## # ... with 4 more variables: Ticket &lt;chr&gt;, Fare &lt;dbl&gt;, Pclass &lt;int&gt;,
## #   Survived &lt;int&gt;</code></pre>
</div>
<hr />
</div>
<div id="stvaranje-novih-stupaca-uz-mutate" class="section level2">
<h2><span class="header-section-number">11.4</span> Stvaranje novih stupaca uz <code>mutate</code></h2>
<p>U radu sa podatkovnim skupovima često se pojavi potreba za stvaranjem dodatnih varijabli uz pomoć informacija pohranjenih u jednoj ili više postojećih varijabli. Novi stupac najčešće stvaramo uz pomoć nekog izraza koji opisuje na koji način transformiramo postojeće podatke; motivacija može biti normalizacija numeričke varijable, stvaranje indikatorske ili kategorijske varijable, sumiranje više varijabli u jednu jedinstvenu varijablu ili bilo koja druga transformacija s ciljem dobivanja nove varijable koja je na neki način potrebna za daljnji proces analize.</p>
<p>Ako pretpostavimo stvaranje novog stupca koji će pohraniti zbroj numeričkih vrijednosti postojećih stupaca, onda bi uz pomoć osnovnih funkcija <em>R</em>-a to proveli na sljedeći način:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">podaci$c &lt;-<span class="st"> </span>podaci$a +<span class="st"> </span>podaci$b</code></pre></div>
<p>Paket <code>dplyr</code> nam nudi alternativu u obliku funkcija <code>mutate</code> i <code>transmute</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(podaci, <span class="dt">c =</span> a +<span class="st"> </span>b)

<span class="kw">transmute</span>(podaci, <span class="dt">c =</span> a +<span class="st"> </span>b)</code></pre></div>
<p>Ove funkcije eksplicitno navode da se radi o stvaranju novih varijabli, a razlika je samo u tome što će <code>transmute</code> zadržati samo novostvorene stupce. Isto tako, uočite da ove funkcije neće mijenjati postojeći okvir, već će stvoriti novi okvir sa dodanim stupcima. Ukoliko želimo da se izmjena reflektira u originalnom okviru, onda to moramo učiniti uz pomoć operatora pridruživanja.</p>
<p>(NAPOMENA: Ovdje se ne moramo bojati degradacije performansi zbog kopiranja okvira, budući da <em>R</em> kod dodavanja stupca radi “plitku kopiju” (<em>shallow copy</em>), tj. novi okvir samo referencira novi stupac dok dijeli reference na preostale stupce sa “originalnim” okvirom. “Duboka kopija” (<em>deep copy</em>) bi značilo da se svi stupci kopiraju u potpuno novi okvir, u kojem slučaju bi ova operacija bila resursno “skupa”)</p>
<p>Uočite da <code>mutate</code> i <code>transmute</code> nisu alternative naredbi <em>UPDATE</em> iz <em>SQL</em>-a, već zapravo odgovaraju <em>SELECT</em> segmentu naredbe u scenarijima kada ne biramo pojedine stupce već ih kombiniramo u sklopu izraza.</p>
<p>Funkcije <code>mutate</code> i <code>transmute</code> koriste uobičajene (vektorizirane) funkcije i operatore, a imamo na raspolaganju i niz dodatnih tzv. “prozorskih” (<em>window</em>) funkcija koje nam omogućuju dodatnu fleksibilnost kod stvaranja novih varijabli, kao npr:</p>
<ul>
<li><code>ntile</code>, <code>cut</code> - stvaranje kategorijske varijable koja grupira vrijednosti u <code>n</code> ladica; <code>ntile</code> će napraviti kategorije jednake veličine, dok će <code>cut</code> rezati u ovisnosti o veličini intervala numeričkih vrijednosti</li>
<li><code>rank</code>, <code>dense_rank</code>, <code>min_rank</code> - rangiranje obzervacija (razlika je samo u tretiranju obzervacija sa istim vrijednostima)</li>
<li><code>between</code> - opisuje da li je varijabla nekog stupca u intervalu zadanom sa dva druga stupca</li>
<li><code>pmin</code>, <code>pmax</code> - “paralelni minimum i maksimum”, tj. minimum i maksimum gledano stupce jedne obzervacije</li>
<li>itd.</li>
</ul>
<p>Popis svih dostupnih funkcija može se pronaći u dokumentaciji.</p>
<hr />
<p><strong>Zadatak 11.5 - funkcija ‘mutate’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tablici `titanic` dodajte logički stupac `hadRelativesOnBoard` koji će opisivati</span>
<span class="co"># da li je putnik imao rodbine na brodu</span>


<span class="co"># za nasumičnih 10 putnica starijih od 20 godina koje su se ukrcale u Southamptonu</span>
<span class="co"># ispišite ime putnice, putničku klasu i prilagođenu cijenu karte</span>
<span class="co"># cijenu karte zamijenite odgovarajućom cijenom koliko bi ona iznosila danas</span>
<span class="co">#   (pretpostavite da je $1 iz 1912. jednak današnjih $23.85, uračunavajući inflaciju)</span>
<span class="co"># novi stupac nazovite `FareToday` a </span>
<span class="co"># iznos zaokružite na dvije decimale i dodajte prefiks `$`</span>
<span class="co"># ispis poredajte po putničkoj klasi silazno</span>


<span class="co"># stvorite stupac FareCategory kojim ćete podijeliti cijene karata </span>
<span class="co"># u pet kategorija jednake veličine</span>
<span class="co"># potom nasumično izaberite 20 putnika i ispišite </span>
<span class="co"># ime putnika, putničku klasu, cijenu karte i kategoriju</span>
<span class="co"># ispis poredajte po kategoriji cijene</span>


<span class="co"># tablici `titanic` dodajte stupac `EmbarkationPort` u kojem će pisati puno </span>
<span class="co"># ime luke ukrcaja (Southampton, Queenstown ili Cherbourg)</span>
<span class="co"># koristite `mutate` i dva `ifelse`</span>


<span class="co"># ispišite prvih 10 redaka tablice `titanic`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tablici `titanic` dodajte logički stupac `hadRelativesOnBoard` koji će opisivati</span>
<span class="co"># da li je putnik imao rodbine na brodu</span>
titanic &lt;-<span class="st"> </span><span class="kw">mutate</span>(titanic, <span class="dt">hadRelativesOnBoard =</span> SibSp &gt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>Parch &gt;<span class="st"> </span><span class="dv">0</span>)</code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># za nasumičnih 10 putnica starijih od 20 godina koje su se ukrcale u Southamptonu</span>
<span class="co"># ispišite ime putnice, putničku klasu i prilagođenu cijenu karte</span>
<span class="co"># cijenu karte zamijenite odgovarajućom cijenom koliko bi ona iznosila danas</span>
<span class="co">#   (pretpostavite da je $1 iz 1912. jednak današnjih $23.85, uračunavajući inflaciju)</span>
<span class="co"># novi stupac nazovite `FareToday` a iznos zaokružite na dvije decimale i dodajte prefiks `$`</span>
<span class="co"># ispis poredajte po putničkoj klasi silazno</span>

<span class="kw">filter</span>(titanic, Sex ==<span class="st"> &#39;female&#39;</span>, Age &gt;<span class="st"> </span><span class="dv">20</span>,  Embarked ==<span class="st"> &#39;S&#39;</span>) %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) %&gt;%<span class="st">  </span>
<span class="kw">transmute</span>(Name, Pclass, <span class="dt">FareToday =</span> <span class="kw">str_c</span>(<span class="st">&quot;$&quot;</span>, <span class="kw">round</span>(Fare *<span class="st"> </span><span class="fl">23.85</span>, <span class="dv">2</span>))) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Pclass))</code></pre></div>
<pre><code>## # A tibble: 10 × 3
##                                                             Name Pclass
##                                                            &lt;chr&gt;  &lt;int&gt;
## 1                                            Cacic, Miss. Marija      3
## 2                              Lindblom, Miss. Augusta Charlotta      3
## 3      Andersson, Mrs. Anders Johan (Alfrida Konstantia Brogren)      3
## 4                                   Nye, Mrs. (Elizabeth Ramell)      2
## 5                                      Funk, Miss. Annie Clemmer      2
## 6             Faunthorpe, Mrs. Lizzie (Elizabeth Anne Wilkinson)      2
## 7  Brown, Mrs. Thomas William Solomon (Elizabeth Catherine Ford)      2
## 8                        West, Mrs. Edwy Arthur (Ada Mary Worth)      2
## 9            Holverson, Mrs. Alexander Oskar (Mary Aline Towner)      1
## 10                  Harris, Mrs. Henry Birkhardt (Irene Wallach)      1
## # ... with 1 more variables: FareToday &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stvorite stupac FareCategory kojim ćete podijeliti cijene karata </span>
<span class="co"># u pet kategorija jednake veličine</span>
<span class="co"># potom nasumično izaberite 20 putnika i ispišite </span>
<span class="co"># ime putnika, putničku klasu, cijenu karte i kategoriju</span>
<span class="co"># ispis poredajte po kategoriji cijene</span>

<span class="kw">mutate</span>(titanic, <span class="dt">FareCategory =</span> <span class="kw">ntile</span>(Fare, <span class="dv">5</span>)) %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">20</span>) %&gt;%<span class="st"> </span>
<span class="kw">select</span>(Name, Pclass, Fare, FareCategory) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(FareCategory)</code></pre></div>
<pre><code>## # A tibble: 20 × 4
##                                 Name Pclass     Fare FareCategory
##                                &lt;chr&gt;  &lt;int&gt;    &lt;dbl&gt;        &lt;int&gt;
## 1        Lundahl, Mr. Johan Svensson      3   7.0542            1
## 2         Watson, Mr. Ennis Hastings      2   0.0000            1
## 3    Landergren, Miss. Aurora Adelia      3   7.2500            1
## 4           Persson, Mr. Ernst Ulrik      3   7.7750            1
## 5            Masselmani, Mrs. Fatima      3   7.2250            1
## 6                 Ohman, Miss. Velin      3   7.7750            1
## 7       Tornquist, Mr. William Henry      3   0.0000            1
## 8    Stanley, Miss. Amy Zillah Elsie      3   7.5500            1
## 9                 Zimmerman, Mr. Leo      3   7.8750            2
## 10 Williams, Mr. Howard Hugh &quot;Harry&quot;      3   8.0500            2
## 11      Nye, Mrs. (Elizabeth Ramell)      2  10.5000            2
## 12       Alhomaki, Mr. Ilmari Rudolf      3   7.9250            2
## 13                Ivanoff, Mr. Kanio      3   7.8958            2
## 14       Hocking, Mr. Richard George      2  11.5000            3
## 15          Bystrom, Mrs. (Karolina)      2  13.0000            3
## 16             Bidois, Miss. Rosalie      1 227.5250            5
## 17    Allison, Master. Hudson Trevor      1 151.5500            5
## 18    Eustis, Miss. Elizabeth Mussey      1  78.2667            5
## 19         White, Mr. Richard Frasar      1  77.2875            5
## 20               Robbins, Mr. Victor      1 227.5250            5</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tablici `titanic` dodajte stupac `EmbarkationPort` u kojem će pisati puno ime luke ukrcaja</span>
<span class="co">#   (Southampton, Queenstown ili Cherbourg)</span>
<span class="co"># koristite `mutate` i dva `ifelse`</span>
<span class="kw">mutate</span>(titanic, <span class="dt">EmbarkationPort =</span> <span class="kw">ifelse</span>(Embarked ==<span class="st"> &#39;S&#39;</span>, <span class="st">&#39;Southampton&#39;</span>, 
            <span class="kw">ifelse</span>(Embarked ==<span class="st"> &#39;C&#39;</span>, <span class="st">&#39;Cherbourg&#39;</span>, <span class="st">&#39;Queenstown&#39;</span>))) -&gt;<span class="st"> </span>titanic

<span class="co"># ispišite prvih 10 redaka tablice `titanic`</span>
<span class="kw">head</span>(titanic, <span class="dv">10</span>)</code></pre></div>
<pre><code>## # A tibble: 10 × 14
##    PassengerId Survived Pclass
##          &lt;int&gt;    &lt;int&gt;  &lt;int&gt;
## 1            1        0      3
## 2            2        1      1
## 3            3        1      3
## 4            4        1      1
## 5            5        0      3
## 6            6        0      3
## 7            7        0      1
## 8            8        0      3
## 9            9        1      3
## 10          10        1      2
## # ... with 11 more variables: Name &lt;chr&gt;, Sex &lt;chr&gt;, Age &lt;dbl&gt;,
## #   SibSp &lt;int&gt;, Parch &lt;int&gt;, Ticket &lt;chr&gt;, Fare &lt;dbl&gt;, Cabin &lt;chr&gt;,
## #   Embarked &lt;chr&gt;, hadRelativesOnBoard &lt;lgl&gt;, EmbarkationPort &lt;chr&gt;</code></pre>
</div>
</div>
<div id="ogledni-podatkovni-skup-houston-flights" class="section level2">
<h2><span class="header-section-number">11.5</span> Ogledni podatkovni skup: <em>Houston flights</em></h2>
<p>Učitajmo paket <code>dplyr</code> i podatkovni okvir <code>hflights</code> koji se nalazi u paketu istog imena i može ga se dohvatiti iz CRAN repozitorija. Nakon učitavanja paketa podatkovni okvir možemo prebaciti u globalnu okolinu uz pomoć funkcije <code>data</code>.</p>
<hr />
<p><strong>Zadatak 11.6 - podatkovni skup ‘hflights’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># učitajte paket `hflights`</span>
<span class="co"># ukoliko je potrebno instalirajte ga sa CRAN repozitorija</span>
<span class="co"># uz pomoć funkcije `data` učitajte okvir u globalnu okolinu</span>

<span class="co"># pretvorite okvir u `hflights` u klasu `tbl`</span>

<span class="co"># upoznajte se s podatkovnim skupom `hflights`</span>
<span class="co"># pored funkcija glimpse/head/itd. možete pogledati i dokumentaciju</span>
<span class="co"># skupa uz pomoć naredbe `?hflights`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;hflights&quot;)  # ukoliko je potrebno</span>
<span class="co">#library(dplyr)               # ako već nisu učitani</span>
<span class="co">#library(hflights)             </span>
<span class="kw">data</span>(hflights)

hflights &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(hflights)

<span class="kw">glimpse</span>(hflights)
<span class="kw">head</span>(hflights)</code></pre></div>
<pre><code>## Observations: 227,496
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;A...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## # A tibble: 6 × 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;     &lt;int&gt;
## 1  2011     1          1         6    1400    1500            AA       428
## 2  2011     1          2         7    1401    1501            AA       428
## 3  2011     1          3         1    1352    1502            AA       428
## 4  2011     1          4         2    1403    1513            AA       428
## 5  2011     1          5         3    1405    1507            AA       428
## 6  2011     1          6         4    1359    1503            AA       428
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
</div>
<div id="grupiranje-i-agregacija-uz-group_by-i-summarise" class="section level2">
<h2><span class="header-section-number">11.6</span> Grupiranje i agregacija uz <code>group_by</code> i <code>summarise</code></h2>
<p>U literaturi koja se bavi analizom podataka često ćemo naići na tzv. SAC paradigmu (engl. <em>Split-Apply-Combine</em>). Radi se o strategiji koja se svodi na rastavljanje velikog zadatka na manje dijelove, obavljanje određenog posla na svakom od dijelova te konačno kombiniranje svih rezultata u jedinstvenu cjelinu. Potrebu za ovom paradigmom nailazimo u različitim scenarijima analize - u eksploratornoj analizi podataka htjet ćemo izračunati različite statistike ili stvoriti nove varijable zasebno za različite podskupove podataka (npr. ovisno o nekoj kategorijskoj varijabli); kod obrade iznimno velikih količina podataka često želimo ubrzati proces obrade na način da podatke razbijemo u manje skupove koji će se svaki obrađivati zasebno (poznati princip <em>Map-Reduce</em>).</p>
<p>Poznavatelji <em>SQL</em>-a će ovaj princip lako prepoznati kao grupiranje i agregaciju koji se provode kroz <em>GROUP BY</em> segment <em>SQL</em> upita uz prateće elemente u <em>SELECT</em> dijelu. Paket <code>dplyr</code> nudi vrlo sličnu funkcionalnost (iako na proceduralni način) - prvo provedemo “grupiranje”, tj. stvaranje podskupova redaka nekog okvira, a onda provodimo daljnje obrade paralelno nad svakim podskupom, da bi na kraju sve rezultate sakupili u jedinstveni podatkovni okvir.</p>
<p>Za grupiranje <code>dplyr</code> nudi funkciju <code>group_by</code> kojom tablicu (podatkovni okvir) pretvaramo u “grupiranu tablicu” (<code>grouped_tbl</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(podaci, a, b, c)</code></pre></div>
<p>Isprobajmo ovu funkciju na našem okviru <code>hflights</code>.</p>
<hr />
<p><strong>Zadatak 11.7 - grupirana tablica</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stvorite varijablu `flight815` koja će sadržavati retke iz tablice `hflights`</span>
<span class="co"># vezane uz let broj 815</span>

<span class="co"># stvorite varijablu `grouped815` koja će sadržavati retke iz `flight815`</span>
<span class="co"># grupirane po mjesecu</span>

<span class="co"># provjerite klasu varijabli `flight815` i `grouped815`</span>


<span class="co"># uz pomoć funkcije `glimpse` pogledajte strukture varijabli `flight815` i `grouped815`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stvorite varijablu `flight815` koja će sadržavati retke iz tablice `hflights`</span>
<span class="co"># vezane uz let broj 815</span>
flight815 &lt;-<span class="st"> </span><span class="kw">filter</span>(hflights, FlightNum ==<span class="st"> </span><span class="dv">815</span>) 

<span class="co"># stvorite varijablu `grouped815` koja će sadržavati retke iz `flight815`</span>
<span class="co"># grupirane po mjesecu</span>
grouped815 &lt;-<span class="st"> </span><span class="kw">group_by</span>(flight815, Month)

<span class="co"># provjerite klasu varijabli `flight815` i `grouped815`</span>
<span class="kw">class</span>(flight815)
<span class="kw">class</span>(grouped815)</code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># uz pomoć funkcije `glimpse` pogledajte strukture varijabli `flight815` i `grouped815`</span>
<span class="kw">glimpse</span>(flight815)
<span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>)  <span class="co"># radi preglednijeg ispisa na konzoli</span>
<span class="kw">glimpse</span>(grouped815)</code></pre></div>
<pre><code>## Observations: 95
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, ...
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6,...
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 21...
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 23...
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;C...
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815,...
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57...
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229,...
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186,...
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33...
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;L...
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 13...
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, ...
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, ...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## [1] &quot;------------------------&quot;
## Observations: 95
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, ...
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6,...
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 21...
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 23...
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;C...
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815,...
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57...
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229,...
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186,...
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33...
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;L...
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 13...
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, ...
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, ...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite prvih pet redaka varijable `flight815` </span>
<span class="kw">head</span>(flight815)

<span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>)   

<span class="co"># ispišite prvih pet redaka varijable `grouped815` </span>
<span class="kw">head</span>(grouped815)</code></pre></div>
<pre><code>## # A tibble: 6 × 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;     &lt;int&gt;
## 1  2011     4         30         6    2116    2255            CO       815
## 2  2011     4         29         5    2109    2252            CO       815
## 3  2011     4         28         4    2111    2255            CO       815
## 4  2011     4         27         3    2112    2326            CO       815
## 5  2011     4         26         2    2124    2321            CO       815
## 6  2011     4         25         1    2145    2327            CO       815
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;
## [1] &quot;------------------------&quot;
## Source: local data frame [6 x 21]
## Groups: Month [1]
## 
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;     &lt;int&gt;
## 1  2011     4         30         6    2116    2255            CO       815
## 2  2011     4         29         5    2109    2252            CO       815
## 3  2011     4         28         4    2111    2255            CO       815
## 4  2011     4         27         3    2112    2326            CO       815
## 5  2011     4         26         2    2124    2321            CO       815
## 6  2011     4         25         1    2145    2327            CO       815
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
<p>Vidimo da grupiranjem nismo “izgubili” nikakvu informaciju - grupirani podatkovni okvir i dalje izgleda identično originalnom, “negrupiranom” okviru. Zapravo jedina naznaka da je nešto drugačije jest nova, nasljeđena klasa te redak <code>Groups:..</code> u ispisu redaka. Ovo znači da je grupiranje okvira samo naznaka da se neke daljnje (najčešće agregacijske) operacije ne izvode nad cijelim okvirom, već nad pojedinim grupama.</p>
<p>Za agregaciju se koristimo funkcijom <code>summarise</code> koja prima podatke (grupiranu tablicu) a potom kombinacije agregacijskih funkcija i stupaca nad kojim se iste izvršavaju, npr.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(podaci, <span class="kw">mean</span>(a), <span class="kw">sd</span>(a))</code></pre></div>
<p>Za agregacijsku funkciju u pravilu možemo koristiti bilo koju funkciju koja vektor vrijednosti svodi na jednu vrijednost (npr. <code>mean</code>, <code>max</code>, <code>sd</code> itd.), a često korištene funkcije koje nudi sam paket <code>dplyr</code> su:</p>
<ul>
<li><code>first</code>, <code>last</code>, <code>nth</code> - prvi, zadnji, <code>n</code>-ti element grupe</li>
<li><code>n</code>, <code>n_distinct</code> - broj (jedinstvenih) vrijednosti</li>
</ul>
<hr />
<p><strong>Zadatak 11.8 - funkcija ‘summarise’</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># izračunajte prosječno kašnjenje u dolasku leta za varijable `flight815` i `grouped815`</span>
<span class="co"># koristite funkciju `summarise`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(flight815, <span class="kw">mean</span>(ArrDelay))
<span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>)   
<span class="kw">summarise</span>(grouped815, <span class="kw">mean</span>(ArrDelay))</code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   `mean(ArrDelay)`
##              &lt;dbl&gt;
## 1         21.61053
## [1] &quot;------------------------&quot;
## # A tibble: 6 × 2
##   Month `mean(ArrDelay)`
##   &lt;int&gt;            &lt;dbl&gt;
## 1     4         21.10714
## 2     5         20.87097
## 3     6         28.03333
## 4     8        -27.50000
## 5     9         14.00000
## 6    10        -13.00000</code></pre>
</div>
<hr />
<p>U praksi ne čuvamo referencu na grupirane tablice već unutar jedne naredbe provodimo cijeli proces odabira redaka i stupaca, grupiranja i provođenja agregacije. Ako koristimo operator <code>%&gt;%</code>, onda to može izgledati ovako:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(podaci, a &gt;<span class="st"> </span><span class="dv">5</span>) %&gt;%<span class="st"> </span><span class="kw">select</span>(a, b, c) %&gt;%<span class="st"> </span><span class="kw">group_by</span>(a,b) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(c)) %&gt;%<span class="st"> </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(b))</code></pre></div>
<p>Uočite funkciju <code>ungroup</code> kojom uklanjamo postojeća grupiranja - ovo radimo kad god želimo da se naknadne operacije više ne rade “po grupama”, već na razini cijelog podatkovnog okvira. Naime, grupiranje neće samo utjecati na agregacijske funkcije, već će se odraziti i na funkcije kao što su <code>mutate</code> (npr. rangiranje unutar grupa) ili <code>arrange</code> tj. promjena redoslijeda (uređivanje rasporeda redaka unutar grupa). Kombinacijama <code>ungroup</code> i <code>group_by</code> lako uvodimo i ukidamo grupiranja prema želji.</p>
<p>Konačno, ponovimo još jednom lako uočljivu sličnost gornjeg izraza sa <em>SQL</em> upitima u relacijskim bazama, uz bitnu razliku da ovdje operacije provodimo proceduralno što uvelike povećava čitljivost te da vrlo lako u bilo kojem trenutku možemo pohraniti i provjeriti međurezultat.</p>
<p>Pokušajmo sada iskoristiti sva dosadašnja saznanja o paketu <code>dplyr</code> i riješiti sljedeće primjere. Svi zadaci vezani su uz cijeli podatkovni skup <code>hflights</code>.</p>
<hr />
<p><strong>Zadatak 11.9 - složeniji upiti</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite koliko je bilo otkazanih letova zbog lošeg vremena u svakom mjesecu</span>
<span class="co"># tablica rezultata mora imati stupce `Month` i `BadWeatherCancellations`</span>

<span class="co"># ispišite prosječno vrijeme kašnjenja u dolasku (ignorirajte retke sa NA)</span>
<span class="co"># za zrakoplovne luke LAX, JFK i LGA u različitim danima u tjednu</span>
<span class="co"># novi stupac nazovite &#39;MeanArrDelay&#39;</span>
<span class="co"># ispis poredajte po vremenu kašnjenja silazno</span>


<span class="co"># pretpostavimo da ste stvorili vlastitu funkciju `mostFreqValue` </span>
<span class="co"># za pronalazak najčešće vrijednosti (tzv. &quot;moda&quot;) unutar faktora ili znakovnog vektora:</span>
mostFreqValue &lt;-<span class="st"> </span>function(x) <span class="kw">table</span>(x) %&gt;%<span class="st"> </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> T) %&gt;%<span class="st"> </span>names %&gt;%<span class="st"> </span>.[<span class="dv">1</span>]
<span class="co"># u tablici `hflights` podijelite vrijeme kašnjenja u dolasku u 10 kategorija uz pomoć funkcije `ntile`</span>
<span class="co"># novi stupac nazovite `ArrDelayCatId`</span>
<span class="co"># za svaku tu kategoriju ispišite identifikator kategorije, ukupan broj letova unutar kategorije,</span>
<span class="co"># minimalno i maksimalno vrijeme kašnjenja u dolasku </span>
<span class="co"># te koja zrakoplovna luka se najčešće pojavljuje u toj kategoriji</span>


<span class="co"># ponovite prethodni primjer ali umjesto funkcije `ntile` isprobajte funkciju `cut`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite koliko je bilo otkazanih letova zbog lošeg vremena u svakom mjesecu</span>
<span class="co"># tablica rezultata mora imati stupce `Month` i `BadWeatherCancellations`</span>

<span class="kw">filter</span>(hflights, CancellationCode ==<span class="st"> &#39;B&#39;</span>) %&gt;%<span class="st"> </span><span class="kw">group_by</span>(Month) %&gt;%<span class="st"> </span>
<span class="kw">summarise</span>(<span class="dt">BadWeatherCancellations =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 12 × 2
##    Month BadWeatherCancellations
##    &lt;int&gt;                   &lt;int&gt;
## 1      1                     149
## 2      2                     929
## 3      3                      50
## 4      4                      40
## 5      5                     106
## 6      6                      49
## 7      7                      29
## 8      8                     108
## 9      9                      38
## 10    10                      46
## 11    11                      13
## 12    12                      95</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispišite prosječno vrijeme kašnjenja u dolasku (ignorirajte retke sa NA)</span>
<span class="co"># za zrakoplovne luke LAX, JFK i LGA u različitim danima u tjednu</span>
<span class="co"># novi stupac nazovite &#39;MeanArrDelay&#39;</span>
<span class="co"># ispis poredajte po vremenu kašnjenja silazno</span>

<span class="kw">filter</span>(hflights, Dest %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;LAX&#39;</span>, <span class="st">&#39;JFK&#39;</span>, <span class="st">&#39;LGA&#39;</span>)) %&gt;%<span class="st"> </span><span class="kw">group_by</span>(DayOfWeek, Dest) %&gt;%<span class="st"> </span>
<span class="kw">summarise</span>(<span class="dt">MeanArrDelay =</span> <span class="kw">round</span>(<span class="kw">mean</span>(ArrDelay, <span class="dt">na.rm =</span> T) , <span class="dv">2</span>)) %&gt;%
<span class="kw">ungroup</span>() %&gt;%<span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(MeanArrDelay))</code></pre></div>
<pre><code>## # A tibble: 21 × 3
##    DayOfWeek  Dest MeanArrDelay
##        &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1          4   LGA        21.26
## 2          4   JFK        17.23
## 3          5   LGA        13.59
## 4          1   LGA        13.46
## 5          7   JFK        10.78
## 6          1   LAX        10.69
## 7          3   LGA        10.47
## 8          4   LAX        10.30
## 9          2   LGA         9.85
## 10         6   JFK         9.76
## # ... with 11 more rows</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pretpostavimo da ste stvorili vlastitu funkciju `mostFreqValue` </span>
<span class="co"># za pronalazak najčešće vrijednosti (tzv. &quot;moda&quot;) unutar faktora ili znakovnog vektora:</span>
mostFreqValue &lt;-<span class="st"> </span>function(x) <span class="kw">table</span>(x) %&gt;%<span class="st"> </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> T) %&gt;%<span class="st"> </span>names %&gt;%<span class="st"> </span>.[<span class="dv">1</span>]
<span class="co"># u tablici `hflights` podijelite vrijeme kašnjenja u dolasku u 10 kategorija uz pomoć funkcije `ntile`</span>
<span class="co"># novi stupac nazovite `ArrDelayCatId`</span>
<span class="co"># za svaku tu kategoriju ispišite identifikator kategorije, ukupan broj letova unutar kategorije,</span>
<span class="co"># minimalno i maksimalno vrijeme kašnjenja u dolasku </span>
<span class="co"># te koja zrakoplovna luka se najčešće pojavljuje u toj kategoriji</span>

<span class="kw">mutate</span>(hflights, <span class="dt">ArrDelayCatId =</span> <span class="kw">ntile</span>(ArrDelay, <span class="dv">10</span>)) %&gt;%<span class="st"> </span>
<span class="kw">group_by</span>(ArrDelayCatId) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">totalFlights =</span> <span class="kw">n</span>(), <span class="dt">minArrDelay =</span> <span class="kw">min</span>(ArrDelay), 
                                    <span class="dt">maxArrDelay =</span> <span class="kw">max</span>(ArrDelay), <span class="dt">mostFreqDest =</span> <span class="kw">mostFreqValue</span>(Dest))</code></pre></div>
<pre><code>## # A tibble: 11 × 5
##    ArrDelayCatId totalFlights minArrDelay maxArrDelay mostFreqDest
##            &lt;int&gt;        &lt;int&gt;       &lt;int&gt;       &lt;int&gt;        &lt;chr&gt;
## 1              1        22388         -70         -14          ATL
## 2              2        22387         -14          -9          ATL
## 3              3        22388          -9          -6          DAL
## 4              4        22387          -6          -3          DAL
## 5              5        22387          -3           0          DAL
## 6              6        22388           0           3          DAL
## 7              7        22387           3           8          DAL
## 8              8        22388           8          15          DAL
## 9              9        22387          15          32          DAL
## 10            10        22387          32         978          DAL
## 11            NA         3622          NA          NA          DAL</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ponovite prethodni primjer ali umjesto funkcije `ntile` isprobajte funkciju `cut`</span>

<span class="kw">mutate</span>(hflights, <span class="dt">ArrDelayCat =</span> <span class="kw">cut</span>(ArrDelay, <span class="dv">10</span>)) %&gt;%<span class="st"> </span>
<span class="kw">group_by</span>(ArrDelayCat) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">totalFlights =</span> <span class="kw">n</span>(), <span class="dt">minArrDelay =</span> <span class="kw">min</span>(ArrDelay), 
                                    <span class="dt">maxArrDelay =</span> <span class="kw">max</span>(ArrDelay), <span class="dt">mostFreqDest =</span> <span class="kw">mostFreqValue</span>(Dest))</code></pre></div>
<pre><code>## # A tibble: 11 × 5
##    ArrDelayCat totalFlights minArrDelay maxArrDelay mostFreqDest
##         &lt;fctr&gt;        &lt;int&gt;       &lt;int&gt;       &lt;int&gt;        &lt;chr&gt;
## 1   (-71,34.8]       203101         -70          34          DAL
## 2   (34.8,140]        18551          35         139          DAL
## 3    (140,244]         1849         140         244          ATL
## 4    (244,349]          294         245         346          ATL
## 5    (349,454]           48         350         450          ATL
## 6    (454,559]           16         458         556          ATL
## 7    (559,664]            4         579         663          DFW
## 8    (664,768]            4         685         766          DFW
## 9    (768,873]            4         775         861          DEN
## 10   (873,979]            3         918         978          DFW
## 11          NA         3622          NA          NA          DAL</code></pre>
</div>
<hr />
</div>
<div id="spajanje-podatkovnih-okvira-uz-join-funkcije" class="section level2">
<h2><span class="header-section-number">11.7</span> Spajanje podatkovnih okvira uz join funkcije</h2>
<p>Spajanje podatkovnih okvira jest operacija poznata svim programerima koji imaju iskustvo u radu sa relacijskim bazama podataka i <em>SQL</em>-om. Kod pohrane u relacijsku bazu podataka tablice se često dekomponiraju u više tablica postupkom koji se naziva “normalizacija”. Svrha normalizacije je poglavito uklanjanje nepotrebne redundancije - svaka tablica zadržava dovoljno podataka kako bi se prema potrebi operacijom spajanja mogli rekonstruirati originalni podaci tj. skupovi obzervacija.</p>
<p>Iako postoje različiti oblici spajanja tablica, daleko najčešće je tzv. “prirodno” spajanje kod koje u jednoj tablici imamo jedinstvene identifikatore vezane uz podatke koji se nalaze u drugoj tablici. Na primjer - zamislimo da imamo tablice Korisnik i Mjesto, gdje tablica korisnika sustava može imati stupac koji pohranjuje poštanski broj mjesta boravišta korisnika, dok se ostali podaci vezani uz mjesta nalaze u drugoj tablici. Pohraniti naziv mjesta u tablicu s korisnicima bilo bi redundantno, budući da poštanski broj kao takav jedinstveno identificira mjesto, a ukoliko želimo kod ispisa korisnika vidjeti i nazive mjesta, obavljamo operaciju prirodnog spajanja dvije tablice po poštanskom broju mjesta koje je tzv. “strani ključ” u tablici <em>Korisnik</em> a istovremeno i “primarni ključ” u tablici <em>Mjesto</em>.</p>
<p>Stvorimo ovakve podatkovne okvire (sa tek nekoliko redaka kako bi koncept bio jasniji).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># inicijalizacija podatkovnih okvira `korisnik` i `mjesto`</span>

korisnik &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">id =</span> <span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>), <span class="dt">prezime =</span> <span class="kw">c</span>(<span class="st">&quot;Ivic&quot;</span>, <span class="st">&quot;Peric&quot;</span>, <span class="st">&quot;Anic&quot;</span>),
                        <span class="dt">pbrBoravista =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">31000</span>, <span class="dv">10000</span>))

mjesto &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">pbr =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>), 
                      <span class="dt">naziv =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>))</code></pre></div>
<p>Ako bi htjeli imati okvir sa stupcima <em>(id, prezime, pbrBoravista, naziv)</em>, moramo prirodno spojiti ova dva okvira. Paket <code>dplyr</code> za ovo nudi funkciju <code>inner_join</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">inner_join</span>(df1, df2, <span class="kw">by</span>(<span class="st">&quot;s1&quot;</span> =<span class="st"> &quot;s2&quot;</span>)</code></pre></div>
<p>gdje su <code>df1</code> i <code>df2</code> podatkovni okviri koje spajamo, a nizovi znakova <em>“s1”</em> i <em>“s2”</em> označavaju imena stupaca “lijevog” i “desnog” okvira prema kojima provodimo spajanje (uočite samo jedan znak jednakosti!). Ukoliko stupac kojeg koristimo ima isto ime u obje tablice možemo navesti samo ime tog stupca (ili znakovni vektor više stupaca ako spajamo preko tzv. “kompozitnog” stranog ključa), ili taj parametar potpuno ispustiti (ako su stupci prema kojima provodimo spajanje jedini stupci čiji se nazivi poklapaju).</p>
<hr />
<p><strong>Zadatak 11.10 - prirodno spajanje</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stvorite okvir `korisnikMjesto` koji će biti rezultat</span>
<span class="co"># prirodnog spajanja okvira `korisnik` i `mjesto`</span>


<span class="co"># ispišite okvir `korisnikMjesto`</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">korisnikMjesto &lt;-<span class="st"> </span><span class="kw">inner_join</span>(korisnik, mjesto, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;pbrBoravista&quot;</span> =<span class="st"> &quot;pbr&quot;</span>))


korisnikMjesto</code></pre></div>
<pre><code>##   id prezime pbrBoravista  naziv
## 1  1    Ivic        10000 Zagreb
## 2  2   Peric        31000 Osijek
## 3  3    Anic        10000 Zagreb</code></pre>
</div>
<hr />
<p>Vodite računa da je spajanje vrlo “skupa” operacija; ako spajate okvire sa vrlo velikim brojem redaka operacija bi mogla trajati vrlo dugo i zauzeti dosta memorije. U slučaju da često dolazi do potrebe za ovakvim “velikim” spajanjima, onda se snažno preporučuje korištenje paketa data.table koji implementira algoritme sa znatno boljim performansama kod operacija spajanja (korištenjem indeksiranja), ili - ukoliko radimo s podacima iz relacijske baze - provesti spajanja na strani baze podataka i onda u <em>R</em> povući rezultat, umjesto da se spajanje ostavlja na odgovornost <em>R</em>-u. U idućem poglavlju prikazati ćemo kako se ovo potencijalno može izvesti i bez potrebe za pisanjem zasebnih <em>SQL</em> naredbi.</p>
<p>Ako pogledamo rezultat gornjeg primjera, možemo vidjeti da smo “izgubili” jedan redak tablice mjesto. Naime, redak <em>(21000, ‘Split’)</em> nije imao pripadajućeg korisnika te je “nestao” iz rezultata. Ovo je potpuno očekivani rezultat prirodnog spajanja, no postoje slučajevi kada želimo zadržati sve retke iz jedne od tablica koje spajamo. U tom slučaju koristimo tzv. “vanjsko spajanje” koje radi identično već viđenom, ali zadržava sve retke iz jedne ili obje od tablica na način da retci koji se ne uspiju spojiti ostaju u rezultatu, ali sa <code>NA</code> vrijednostima sa suprotne strane. Razlikujemo “lijevo”, “desno”, i “puno” vanjsko spajanje, u ovisnosti želimo li zadržati sve retke iz lijeve, desne ili obje tablice. Paket <code>dplyr</code> nudi funkcije koje obavljaju sve ove tipove spajanja, one imaju potpis identičan gore viđenoj funkciji a zovu se <code>left_join</code>, <code>right_join</code> i <code>full_join</code>.</p>
<hr />
<p><strong>Zadatak 11.11 - vanjsko spajanje</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stvorite okvir `korisnikMjesto2` koji će biti rezultat</span>
<span class="co"># prirodnog spajanja okvira `korisnik` i `mjesto`</span>
<span class="co"># ali će zadržati sve retke iz tablice &#39;mjesto`</span>

<span class="co"># ispišite okvir `korisnikMjesto2`</span>
<span class="co"># retke poredajte po identifikatoru korisnika</span></code></pre></div>
<div class="fold s o">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">korisnikMjesto2 &lt;-<span class="st"> </span><span class="kw">right_join</span>(korisnik, mjesto, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;pbrBoravista&quot;</span> =<span class="st"> &quot;pbr&quot;</span>))


korisnikMjesto2 %&gt;%<span class="st"> </span><span class="kw">arrange</span>(id)</code></pre></div>
<pre><code>##   id prezime pbrBoravista  naziv
## 1  1    Ivic        10000 Zagreb
## 2  2   Peric        31000 Osijek
## 3  3    Anic        10000 Zagreb
## 4 NA    &lt;NA&gt;        21000  Split</code></pre>
</div>
<hr />
</div>
<div id="integracija-sa-relacijskim-bazama-podataka" class="section level2">
<h2><span class="header-section-number">11.8</span> Integracija sa relacijskim bazama podataka</h2>
<p>Relacijske baze česti su izvor podataka za analize koje radimo u jeziku <em>R</em>. Jedna od standardnih procedura pripreme podataka za analitički proces je tzv. “izvoženje” (engl. <em>export</em>) podataka iz baze u <em>CSV</em> datoteku, koja se potom učitava u <em>R</em>. Često se prije stvaranja <em>CSV</em> datoteke prvo podaci iz baze moraju prikupiti i pripremiti na adekvatan način, što znači da cjelokupni proces pripreme podataka incijalno zahtjeva rad u <em>SQL</em>-u nad bazom podataka. Ovo je pogotovo bitno ako radimo sa većim skupovima podataka koji bi nepotrebno opteretili stroj nad kojim radimo analize u <em>R</em>-u, a koji bi se mogli znatno učinkovitije i brže mogli obraditi u bazi podataka.</p>
<p>Gore navedeno ne znači nužno da nam za prikupljanje podataka iz baze treba zaseban alat pomoću kojeg ćemo izvoditi <em>SQL</em> upite. <em>R</em> sadrži niz paketa za direktno spajanje i rad sa popularnijim bazama podataka, kao što su npr. <em>MySQL</em> ili <em>PostgreSQL</em>. Uz pomoć ovih paketa možemo unutar <em>R</em> skripte uspostaviti konekciju sa bazom i izvoditi <em>SQL</em> upite, a sve uz pomoć R naredbi pri čemu kao konačni rezultat dobivamo podatkovni okvir spreman za daljnje korake analize. Npr. rad direktno nad <em>MySQL</em> bazom može izgledati ovako:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;RMySQL&quot;</span>)

<span class="kw">library</span>(RMySQL)

<span class="co"># unijeti stvarne parametre kod realnog scenarija!</span>
conn =<span class="st"> </span><span class="kw">dbConnect</span>(<span class="kw">MySQL</span>(), <span class="dt">user=</span><span class="st">&#39;user&#39;</span>, <span class="dt">password=</span><span class="st">&#39;password&#39;</span>, <span class="dt">dbname=</span><span class="st">&#39;database_name&#39;</span>, <span class="dt">host=</span><span class="st">&#39;host&#39;</span>)

df =<span class="st"> </span><span class="kw">dbSendQuery</span>(conn, <span class="st">&quot;SELECT * FROM MY_TABLE&quot;</span>)</code></pre></div>
<p>Vidimo da prvo moramo učitati paket s podrškom za spajanje na odabranu bazu, potom uspostavljamo konekciju sa bazom (parametre nam obično daje administrator same baze), a onda uz pomoć odgovarajućih funkcija postavljamo <em>SQL</em> upite). Iako ovakav pristup nije kompliciran i relativno se često koristi, on neumitno zahtijeva miješanje programskog koda u <em>SQL</em>-u i programskog koda u <em>R</em>-u.</p>
<p>Paket dplyr može ovdje pomoći na način da rastereti programera od potrebe pisanja <em>SQL</em> upita unutar <em>R</em> skripte. Naime, <code>dplyr</code> sadrži integriranu podršku za automatsku konverziju izraza koji koriste <code>dplyr</code> funkcije direktno u <em>SQL</em> upit, a što je transparentno za korisnika. Drugim riječima, do izvjesne mjere možemo na isti način raditi nad relacijskom bazom podataka kao da se radi o podatkovnim okvirima u memoriji računala. Ovdje trebamo biti oprezni jer ne možemo očekivati da će nam sve funkcionalnosti <code>dplyr</code>-a moći biti automatski prevedene u <em>SQL</em>, ali neke standardne pripremne operacije poput spajanje i filtriranja se na ovaj način mogu raditi direktno u bazi, a kroz čisti <em>R</em> programski kod.</p>
<p>Kako bi mogli ovo isprobati u praksi, potrebna nam je relacijska baza podataka. Budući da nije praktično u ovom trenutku instalirati ili pripremati postojeću relacijsku bazu podataka samo za potrebe nekolicine primjera, učinit ćemo ono što radi većina <em>R</em> programera kada želi razvijati programski kod vezan uz relacijske baze, ali izbjeći potrebu za pristupom konkretnoj bazi podataka - koristiti ćemo se tzv. <em>SQLite </em>bazom. Ovo je jednostavna baza koja ne zahtijeva posebnu instalaciju, ne koristi poslužitelj i sve podatke drži u jednoj datoteci.</p>
<p>U sljedećem programskom odsječku učitavamo paket <em>RSQLite</em>, stvaramo novu bazu kreiranjem nove datoteke (ili se spajamo na postojeću ako datoteka ne postoji) te spremamo okvir <code>mtcars</code> u tablicu <em>AUTI</em> što će nam glumiti “podatke u bazi”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># instalacija i učitavanje paketa `RSQLite` (izvesti ako je potrebno)</span>
<span class="co">#install.packages(&quot;RSQLite&quot;)      </span>
<span class="co">#library(RSQLite)                 </span>

<span class="co"># otvaramo konekciju sa bazom &quot;SQLite&quot;</span>
<span class="co"># (zapravo stvaramo datoteku &#39;moja.baza&#39;)</span>
conn &lt;-<span class="kw">dbConnect</span>(<span class="dt">drv=</span><span class="kw">SQLite</span>(), <span class="dt">dbname=</span><span class="st">&quot;moja.baza&quot;</span>)

<span class="co"># stvaramo tablicu `AUTI` u koju pohranjujemo</span>
<span class="co"># prvih 100 redaka tablice `mtcars`</span>
<span class="co"># ovo simulira &quot;tablicu u bazi&quot;</span>
<span class="kw">dbWriteTable</span>(conn, <span class="st">&quot;AUTI&quot;</span>, mtcars[<span class="dv">1</span>:<span class="dv">100</span>,], <span class="dt">overwrite =</span> T)

<span class="co"># provjeramo popis svih tablica</span>
<span class="kw">dbListTables</span>(conn)</code></pre></div>
<pre><code>## [1] TRUE
## [1] &quot;AUTI&quot;</code></pre>
<p>Uobičajeni način prikupljanja podataka iz baze jest ugradnja <em>SQL</em> upita direktno u <em>R</em> programski kod i pohrana rezultata u varijablu.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ispisujemo podatke o maksimalnoj brzini i težini svih automobila sa 6 cilindara</span>

<span class="kw">dbGetQuery</span>(conn, <span class="st">&quot;SELECT mpg, wt FROM AUTI WHERE cyl = 6&quot;</span>)</code></pre></div>
<pre><code>##    mpg    wt
## 1 21.0 2.620
## 2 21.0 2.875
## 3 21.4 3.215
## 4 18.1 3.460
## 5 19.2 3.440
## 6 17.8 3.440
## 7 19.7 2.770</code></pre>
<p>Ako dobro poznajemo SQL, onda ovakav način prikupljanja podataka vjerojatno ne izgleda pretjerano kompleksno i uistinu, veliki broj programera i analitičara rado kombinira <em>SQL</em> i <em>R</em> kako bi optimizirali proces prikupljanja i pripreme podataka. No ako nismo “jaki” u <em>SQ</em>L-u, ili jednostavno želimo “čistiji” kod, možemo se koristiti alatima koje nam nudi paket <code>dplyr</code>.</p>
<p>U idućem primjeru ponoviti ćemo dio gore prikazanog postupka (spojiti ćemo se na <em>SQLite</em> bazu nazvanu <em>moja.baza</em> i ispisati podatke iz tablice <em>AUTI</em>), ali ćemo sve izvesti uz pomoć <code>dplyr</code> funkcija.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># povezujem se sa postojećom SQLite bazom</span>
conn2 &lt;-<span class="st"> </span><span class="kw">src_sqlite</span>(<span class="st">&quot;moja.baza&quot;</span>, <span class="dt">create =</span> <span class="ot">FALSE</span>)

<span class="co"># pogledajmo da li je tablica AUTI u bazi</span>
<span class="kw">src_tbls</span>(conn2)

<span class="co"># stvaram referencu na ovu tablicu</span>
<span class="co"># (ništa se ne učitava dok ne pristupam podacima!)</span>
auti &lt;-<span class="st"> </span><span class="kw">tbl</span>(conn2, <span class="st">&quot;AUTI&quot;</span>)

<span class="co"># ispisujemo podatke o maksimalnoj brzini i težini svih automobila sa 6 cilindara</span>
auti %&gt;%<span class="st"> </span><span class="kw">filter</span>(cyl ==<span class="st"> </span><span class="dv">6</span>) %&gt;%<span class="st"> </span><span class="kw">select</span>(mpg, wt) %&gt;%<span class="st"> </span>collect</code></pre></div>
<pre><code>## [1] &quot;AUTI&quot;
## # A tibble: 7 × 2
##     mpg    wt
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  21.0 2.620
## 2  21.0 2.875
## 3  21.4 3.215
## 4  18.1 3.460
## 5  19.2 3.440
## 6  17.8 3.440
## 7  19.7 2.770</code></pre>
<p>Ključno je znati da <code>dplyr</code> neće ništa izvoditi do trenutka kada mi eksplicitno zatražimo tražene podatke, a i tada će ih dohvaćati “u porcijama” kako nam ne bi zagušio memoriju. Upravo zbog toga smo u gornjem primjeru koristili funkciju <code>collect</code>, koja zapravo znači “dohvati cijeli rezultat i pohrani ga u podatkovni okvir” (u našem slučaju mi smo ga jednostavno ispisali na zaslon). Na ovaj način <em>R</em> programer može znatno rasteretiti svoju <em>R</em> okolinu prebacujući odgovornost “teških” proračuna na bazu podataka, a sve uz korištenje istih funkcija koje koristi za upravljanje podatkovnim skupovima pohranjenim u memoriji računala u obliku podatkovnih okvira.</p>
<hr />
</div>
<div id="zadaci-za-vjezbu-9" class="section level2 unnumbered">
<h2>Zadaci za vježbu</h2>
<p>U zadacima za vježbu poslužiti ćemo se proširenom podatkovnim skupom <em>mammals sleep</em> dostupnim u vizualizacijskom paketu <code>ggplot2</code>. Učitajte paket <code>ggplot2</code> te potom prenesite podatkovni okvir <code>msleep</code> u globalnu okolinu uz pomoć funkcije <code>data</code>.</p>
<p>Prije rješavanja učitajte podatkovni skup i upoznajte se s njim uz pomoć uobičajenih funkcija.</p>
<ol style="list-style-type: decimal">
<li><p>Za 10 biljojeda koji najdulje spavaju ispišite ime, koliko dnevno spavaju i prosječnu tjelesnu, težinu u kg. Ispis poredajte po duljini spavanja silazno.</p></li>
<li><p>Ispišite prosječno, najdulje i najkraće vrijeme spavanja životinja ovisno o njihovom tipu prehrane.</p></li>
<li><p>Podijelite ukupno vrijeme spavanja u 5 razreda jednoliko po ukupnoj duljini dnevnog spavanja. Za svaki razred ispišite ukupan broj životinja koje pripadaju razredu, a potom posebno ukupan broj pripadnika razreda koji nisu biljojedi. Ispis poredajte od razreda životinja koje najmanje spavaju naviše. Stupce nazovite smisleno i pripazite da konačna tablica nema NA vrijednosti.</p></li>
<li><p>Sljedeći okvir sadrži šifre statusa očuvanja životinja i njihove opise:</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conservationStatus &lt;-<span class="st"> </span><span class="kw">data.frame</span>( 
  <span class="dt">code =</span> <span class="kw">c</span>(<span class="st">&quot;ex&quot;</span>, <span class="st">&quot;ew&quot;</span>, <span class="st">&quot;cr&quot;</span>, <span class="st">&quot;en&quot;</span>, <span class="st">&quot;vu&quot;</span>, <span class="st">&quot;nt&quot;</span>, <span class="st">&quot;cd&quot;</span>, <span class="st">&quot;lc&quot;</span>),
  <span class="dt">description =</span> <span class="kw">c</span>(<span class="st">&quot;extinct&quot;</span>, <span class="st">&quot;extinct in the wild&quot;</span>, 
                 <span class="st">&quot;critically endangered&quot;</span>, <span class="st">&quot;endangered&quot;</span>,
                 <span class="st">&quot;vulnerable&quot;</span>, <span class="st">&quot;near threatened&quot;</span>, 
                 <span class="st">&quot;conservation dependent&quot;</span>, <span class="st">&quot;least concern&quot;</span>))</code></pre></div>
<p>Dodajte okviru <code>msleep</code> stupac <code>conservationDesc</code> koji će sadržavati pripadajuće opise preuzete iz gornjeg okvira. Pripazite da kod proširenja ne izgubite nijedan redak iz okvira <code>msleep</code>.</p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datumi.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vizualizacija-podataka-uz-paket-ggplot2.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["osnoveR.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"edit": null,
"download": null,
"search": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
